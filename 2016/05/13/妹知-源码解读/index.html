
 <!DOCTYPE HTML>
<html lang="default">
<head>
  <meta charset="UTF-8">
  
    <title>妹知-源码解读 | 曾先生&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="曾奇">
    

    
    <meta name="description" content="关于@TargetApi的作用，及与@SuppressLint的不同：http://wenrisheng.iteye.com/blog/2175528
总结：安卓开发中，在低版本SDK使用高版本的API会报错。一般处理方法是换一种实现方法，或者在高版本SDK中使用高版本API，低版本SDK中使用效果可能会差点的折衷方案；后者可以用如下技巧来实现。步骤：1.在使用了高版本API的方法前面加一个 @T">
<meta property="og:type" content="article">
<meta property="og:title" content="妹知-源码解读">
<meta property="og:url" content="http://yoursite.com/2016/05/13/妹知-源码解读/index.html">
<meta property="og:site_name" content="曾先生's Blog">
<meta property="og:description" content="关于@TargetApi的作用，及与@SuppressLint的不同：http://wenrisheng.iteye.com/blog/2175528
总结：安卓开发中，在低版本SDK使用高版本的API会报错。一般处理方法是换一种实现方法，或者在高版本SDK中使用高版本API，低版本SDK中使用效果可能会差点的折衷方案；后者可以用如下技巧来实现。步骤：1.在使用了高版本API的方法前面加一个 @T">
<meta property="og:image" content="http://img.blog.csdn.net/20160517214726671">
<meta property="og:image" content="http://img.blog.csdn.net/20160517215027422">
<meta property="og:image" content="http://img.blog.csdn.net/20160517215840725">
<meta property="og:image" content="http://img.blog.csdn.net/20160517220710798">
<meta property="og:image" content="http://img.blog.csdn.net/20160517221644870">
<meta property="og:image" content="http://img.blog.csdn.net/20160517224442740">
<meta property="og:updated_time" content="2016-06-01T08:48:22.221Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="妹知-源码解读">
<meta name="twitter:description" content="关于@TargetApi的作用，及与@SuppressLint的不同：http://wenrisheng.iteye.com/blog/2175528
总结：安卓开发中，在低版本SDK使用高版本的API会报错。一般处理方法是换一种实现方法，或者在高版本SDK中使用高版本API，低版本SDK中使用效果可能会差点的折衷方案；后者可以用如下技巧来实现。步骤：1.在使用了高版本API的方法前面加一个 @T">
<meta name="twitter:image" content="http://img.blog.csdn.net/20160517214726671">

    
    <link rel="alternative" href="/atom.xml" title="曾先生&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="曾先生&#39;s Blog" title="曾先生&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="曾先生&#39;s Blog">曾先生&#39;s Blog</a></h1>
				<h2 class="blog-motto">飞面神教四川担担面教区主教</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于我</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/13/妹知-源码解读/" title="妹知-源码解读" itemprop="url">妹知-源码解读</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="曾奇" target="_blank" itemprop="author">曾奇</a>
		
  <p class="article-time">
    <time datetime="2016-05-13T08:44:25.000Z" itemprop="datePublished"> Published 2016-05-13</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			
		
		</div>
		
		<p>关于@TargetApi的作用，及与@SuppressLint的不同：<br><a href="http://wenrisheng.iteye.com/blog/2175528" target="_blank" rel="external">http://wenrisheng.iteye.com/blog/2175528</a></p>
<p>总结：<br>安卓开发中，在低版本SDK使用高版本的API会报错。一般处理方法是换一种实现方法，或者在高版本SDK中使用高版本API，低版本SDK中使用效果可能会差点的折衷方案；后者可以用如下技巧来实现。<br>步骤：<br>1.在使用了高版本API的方法前面加一个 @TargetApi(API号)<br>2.在代码上用版本判断来控制不同版本使用不同的代码</p>
<p>针对不同版本的Android Activity 全屏方法总结全在这里啦：<br><a href="http://talentprince.github.io/blog/2015/01/07/android-activity-quan-ping-fang-fa-zong-jie/" target="_blank" rel="external">http://talentprince.github.io/blog/2015/01/07/android-activity-quan-ping-fang-fa-zong-jie/</a></p>
<p>关于发布release版本：<br>1.open Build Variants<br>2.set debug to release<br>3.shift+f10 run!!</p>
<p>实现继承自RecyclerView.Adapter的Adapter要实现三个抽象方法，onCreateViewHolder，onBindViewHolder，getItemCount。如下图：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public static class Adapter extends RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;&#123;</span><br><span class="line"></span><br><span class="line">		//创建新View，被LayoutManager所调用</span><br><span class="line">        @Override</span><br><span class="line">        public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">		//将数据与界面进行绑定的操作</span><br><span class="line">        @Override</span><br><span class="line">        public void onBindViewHolder(RecyclerView.ViewHolder holder, int position) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">		//获取数据的数量</span><br><span class="line">        @Override</span><br><span class="line">        public int getItemCount() &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>具体的实现案例参考NewsListAdapter。<br>详情分析：<br><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2014/1118/2004.html" target="_blank" rel="external">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2014/1118/2004.html</a></p>
<p>一般app广告图片循环控件：<br><a href="https://github.com/saiwu-bigkoo/Android-ConvenientBanner" target="_blank" rel="external">https://github.com/saiwu-bigkoo/Android-ConvenientBanner</a></p>
<p><strong>试验Fragment启动顺序的结果（待解释）</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">开始：</span><br><span class="line">05-17 15:30:42.698 6043-6043/com.zengqi.knowledge I/baseFragment: onCreateView</span><br><span class="line">05-17 15:30:42.718 6043-6043/com.zengqi.knowledge I/baseFragment: onActivityCreated</span><br><span class="line">05-17 15:30:42.718 6043-6043/com.zengqi.knowledge I/baseFragment: onstart</span><br><span class="line">05-17 15:30:42.768 6043-6043/com.zengqi.knowledge I/baseFragment: onCreateView</span><br><span class="line">05-17 15:30:42.768 6043-6043/com.zengqi.knowledge I/RecyclerFragment: initlayoutId implement</span><br><span class="line">05-17 15:30:42.778 6043-6043/com.zengqi.knowledge I/ZhihuFragment: initViews implement</span><br><span class="line">05-17 15:30:42.778 6043-6043/com.zengqi.knowledge I/RecyclerFragment: initViews implement</span><br><span class="line">05-17 15:30:42.778 6043-6043/com.zengqi.knowledge I/baseFragment: onActivityCreated</span><br><span class="line">05-17 15:30:42.778 6043-6043/com.zengqi.knowledge I/ZhihuFragment: initData implement</span><br><span class="line">05-17 15:30:42.808 6043-6043/com.zengqi.knowledge I/baseFragment: onstart</span><br><span class="line">05-17 15:30:42.808 6043-6043/com.zengqi.knowledge I/baseFragment: onCreateView</span><br><span class="line">05-17 15:30:42.808 6043-6043/com.zengqi.knowledge I/RecyclerFragment: initlayoutId implement</span><br><span class="line">05-17 15:30:42.808 6043-6043/com.zengqi.knowledge I/RecyclerFragment: initViews implement</span><br><span class="line">05-17 15:30:42.808 6043-6043/com.zengqi.knowledge I/baseFragment: onActivityCreated</span><br><span class="line">05-17 15:30:42.808 6043-6043/com.zengqi.knowledge I/baseFragment: onstart</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">退出（切换至picFragment,其继承自RecyclerFragment，注意我没在picFragment生命周期中打Log）：</span><br><span class="line">05-17 15:44:51.253 6043-6043/com.zengqi.knowledge I/RecyclerFragment: onPause</span><br><span class="line">05-17 15:44:51.253 6043-6043/com.zengqi.knowledge I/RecyclerFragment: onPause</span><br><span class="line">05-17 15:44:51.263 6043-6043/com.zengqi.knowledge I/ZhihuFragment: ondestroyView</span><br><span class="line">05-17 15:44:51.263 6043-6043/com.zengqi.knowledge I/RecyclerFragment: ondestroyView</span><br><span class="line">05-17 15:44:51.263 6043-6043/com.zengqi.knowledge I/baseFragment: ondestroyView</span><br><span class="line">05-17 15:44:51.273 6043-6043/com.zengqi.knowledge I/RecyclerFragment: ondestroyView</span><br><span class="line">05-17 15:44:51.273 6043-6043/com.zengqi.knowledge I/baseFragment: ondestroyView</span><br><span class="line">05-17 15:44:51.273 6043-6043/com.zengqi.knowledge I/baseFragment: ondestroyView</span><br><span class="line">05-17 15:44:51.273 6043-6043/com.zengqi.knowledge I/baseFragment: ondestroy</span><br><span class="line">05-17 15:44:51.273 6043-6043/com.zengqi.knowledge I/baseFragment: ondestroy</span><br><span class="line">05-17 15:44:51.273 6043-6043/com.zengqi.knowledge I/baseFragment: ondestroy</span><br><span class="line">05-17 15:44:51.273 6043-6043/com.zengqi.knowledge I/baseFragment: onCreateView</span><br><span class="line">05-17 15:44:51.303 6043-6043/com.zengqi.knowledge I/baseFragment: onActivityCreated</span><br><span class="line">05-17 15:44:51.303 6043-6043/com.zengqi.knowledge I/baseFragment: onstart</span><br><span class="line">05-17 15:44:51.343 6043-6043/com.zengqi.knowledge I/baseFragment: onCreateView</span><br><span class="line">05-17 15:44:51.343 6043-6043/com.zengqi.knowledge I/RecyclerFragment: initlayoutId implement</span><br><span class="line">05-17 15:44:51.343 6043-6043/com.zengqi.knowledge I/RecyclerFragment: initViews implement</span><br><span class="line">05-17 15:44:51.353 6043-6043/com.zengqi.knowledge I/baseFragment: onActivityCreated</span><br><span class="line">05-17 15:44:51.363 6043-6043/com.zengqi.knowledge I/baseFragment: onstart</span><br><span class="line">05-17 15:44:51.363 6043-6043/com.zengqi.knowledge I/baseFragment: onCreateView</span><br><span class="line">05-17 15:44:51.363 6043-6043/com.zengqi.knowledge I/RecyclerFragment: initlayoutId implement</span><br><span class="line">05-17 15:44:51.363 6043-6043/com.zengqi.knowledge I/RecyclerFragment: initViews implement</span><br><span class="line">05-17 15:44:51.373 6043-6043/com.zengqi.knowledge I/baseFragment: onActivityCreated</span><br><span class="line">05-17 15:44:51.373 6043-6043/com.zengqi.knowledge I/baseFragment: onstart</span><br></pre></td></tr></table></figure>
<p>关于本地广播管理者LocalBroadcastManager：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Helper to register for and send broadcasts of Intents to local objects</span><br><span class="line"> * within your process.  This is has a number of advantages over sending</span><br><span class="line"> * global broadcasts with &#123;@link android.content.Context#sendBroadcast&#125;:</span><br><span class="line"> * &lt;ul&gt;</span><br><span class="line"> * &lt;li&gt; You know that the data you are broadcasting won&apos;t leave your app, so</span><br><span class="line"> * don&apos;t need to worry about leaking private data.</span><br><span class="line"> * &lt;li&gt; It is not possible for other applications to send these broadcasts to</span><br><span class="line"> * your app, so you don&apos;t need to worry about having security holes they can</span><br><span class="line"> * exploit.</span><br><span class="line"> * &lt;li&gt; It is more efficient than sending a global broadcast through the</span><br><span class="line"> * system.</span><br><span class="line"> * &lt;/ul&gt;</span><br><span class="line"> */</span><br><span class="line"> public class LocalBroadcastManager &#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>fresh爬的网站是：<a href="http://jandan.net/" target="_blank" rel="external">http://jandan.net/</a></p>
<p>有关API：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//Zhihu API</span><br><span class="line">    public static final String BASE_URL = &quot;http://news-at.zhihu.com/api/4/news/&quot;;</span><br><span class="line">    public static final String NEWS_LATEST = &quot;http://news-at.zhihu.com/api/4/news/latest&quot;;</span><br><span class="line">    public static final String NEWS_BEFORE = &quot;http://news-at.zhihu.com/api/4/news/before/&quot;;</span><br><span class="line">    public static final String SPLASH = &quot;http://news-at.zhihu.com/api/4/start-image/1080*1920&quot;;//知乎每天更新不同的启动图片</span><br><span class="line">    //Fresh things API</span><br><span class="line">    public static final String FRESH_NEWS = &quot;http://jandan.net/?oxwlxojflwblxbsapi=get_recent_posts&amp;include=url,date,tags,author,title,comment_count,custom_fields&amp;custom_fields=thumb_c,views&amp;dev=1&amp;page=&quot;;</span><br><span class="line">    public static final String FRESH_NEWS_DETAIL = &quot;http://i.jandan.net/?oxwlxojflwblxbsapi=get_post&amp;include=content&amp;id=&quot;;</span><br><span class="line">    public static final String FRESH_NEWS_COMMENTS = &quot;http://jandan.duoshuo.com/api/threads/listPosts.json?thread_key=&quot;;</span><br><span class="line">    public static final String TAG_H = &quot;h&quot;;</span><br></pre></td></tr></table></figure>
<p>FRESH_NEWS返回的数据格式是：<br><img src="http://img.blog.csdn.net/20160517214726671" alt=""><br>展开post：<br><img src="http://img.blog.csdn.net/20160517215027422" alt=""><br>post具体由id,url,title,date,tags,author,comment_count,custom_fields（里面的thumb_c为缩略图）组成。</p>
<p>FRESH_NEWS_DETAILS应该这样使用（后面跟请求detail的id）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">API.FRESH_NEWS_DETAIL + freshPost.getId()</span><br></pre></td></tr></table></figure>
<p>返回数据是：<br><img src="http://img.blog.csdn.net/20160517215840725" alt=""><br>注意post中的id跟上面post中的id相对应！</p>
<p>关于知乎API的应该这样用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">API.BASE_URL + newsItem.getId()//加id</span><br><span class="line">API.NEWS_BEFORE + date</span><br></pre></td></tr></table></figure>
<p>调用before的效果：<br><img src="http://img.blog.csdn.net/20160517220710798" alt=""><br>注意此时的date返回的是输入参数date的前一天，如果输入参数的前一天还没有到，那么返回最新的数据，此时跟latest是一样的效果。<br>返回数据格式：date,stories(images,type,id,title,ga_prefix)</p>
<p>通过id得到具体的story返回的数据：<br><img src="http://img.blog.csdn.net/20160517221644870" alt=""><br>返回数据格式：body,title,image,share_url,ga_prefix,images,type(作用未知)，js(供手机端的 WebView(UIWebView) 使用),css（供手机端的 WebView(UIWebView) 使用。可知，知乎日报的文章浏览界面利用 WebView(UIWebView) 实现）。</p>
<p>关于返回的images数组要注意：官方 API 使用数组形式。目前暂未有使用多张图片的情形出现，曾见无 images 属性的情况，请在使用中注意！</p>
<p><strong>更多知乎API的分析，请移步</strong>：<br><a href="https://github.com/izzyleung/ZhihuDailyPurify/wiki/%E7%9F%A5%E4%B9%8E%E6%97%A5%E6%8A%A5-API-%E5%88%86%E6%9E%90。" target="_blank" rel="external">https://github.com/izzyleung/ZhihuDailyPurify/wiki/%E7%9F%A5%E4%B9%8E%E6%97%A5%E6%8A%A5-API-%E5%88%86%E6%9E%90。</a></p>
<p><strong>关于GANK</strong>:<br><a href="http://gank.io/api里面有各种API，供君享用。" target="_blank" rel="external">http://gank.io/api里面有各种API，供君享用。</a></p>
<p>本例中：<br><img src="http://img.blog.csdn.net/20160517224442740" alt=""></p>
<p>豆瓣美女的API用法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">API.DB_BREAST + page</span><br><span class="line">其他DB分类都一样</span><br></pre></td></tr></table></figure>
<p>HAPI的用法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">API.H_MAIN + type + &quot;&amp;page=&quot; + page</span><br><span class="line">type和page都为int</span><br></pre></td></tr></table></figure>
<p>经测试，网址无法使用。</p>
<p>这些API中，有些是直接返回json格式的数据，有些只是网址！对于前者，可以直接通过解析json的工具进行解析，对于后者，用jsoup工具进行解析。</p>
<p>关于FragmentStatePagerAdapter：</p>
<p>Implementation of PagerAdapter that uses a Fragment to manage each page. This class also handles saving and restoring of fragment’s state.</p>
<p>This version of the pager is more useful when there are a large number of pages, working more like a list view. When pages are not visible to the user, their entire fragment may be destroyed, only keeping the saved state of that fragment. This allows the pager to hold on to much less memory associated with each visited page as compared to FragmentPagerAdapter at the cost of potentially more overhead when switching between pages.</p>
<p>When using FragmentPagerAdapter the host ViewPager must have a valid ID set.</p>
<p>Subclasses only need to implement getItem(int) and getCount() to have a working adapter.</p>
<p>关于共享元素的教程：<br><a href="http://jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0113/2310.html" target="_blank" rel="external">http://jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0113/2310.html</a><br>共4章。<br>在5.0之后才能实现这种变换。<br>关于动画transition（包含共享元素，并没有传递position的解答）：<br><a href="https://github.com/lgvalle/Material-Animations" target="_blank" rel="external">https://github.com/lgvalle/Material-Animations</a></p>
<p>大概讲了：<br>Android Transition Framework can be used for three main things:</p>
<p>1.Animate activity layout content when transitioning from one activity to another.<br>2.Animate shared elements (Hero views) in transitions between activities.<br>3.Animate view changes within same activity.</p>
<ol>
<li>Transitions between Activities</li>
<li>Shared elements between Activities（Shared elements between fragments，Allow Transition Overlap）</li>
<li>Animate view layout elements</li>
<li>(Bonus) Shared elements + Circular Reveal</li>
</ol>
<p>在stackoverflow上的问题解答(关于共享元素在viewpager中改变了，怎么传递position到启动方，例子中两者均为activity)：</p>
<p>From what I can tell (and correct me if I’m wrong), what you are trying to achieve is basically something like this: <strong>Assume you have a MainActivity, a DetailsActivity, and an arbitrary set of images. The MainActivity displays the set of images in a grid and the DetailsActivity displays the same set of images in a horizontal ViewPager. When the user selects an image in the MainActivity, that image should transition from its position in the grid to the correct page in the second activity’s ViewPager.</strong></p>
<p>The problem we want to solve is “<strong>what if the user switches pages inside the DetailsActivity</strong>“? If this happens, we want to change the shared image that will be used during the return transition. By default, the activity transition framework will use the shared element that was used during the enter transition… but the view pager’s page has changed so obviously we want to somehow override this behavior. To do so, we will need to set a SharedElementCallback in your MainActivity and DetailsActivity’s onCreate() methods and override the onMapSharedElements() method like so:</p>
<p>private final SharedElementCallback mCallback = new SharedElementCallback() {<br>    @Override<br>    public void onMapSharedElements(List<string> names, Map<string, view=""> sharedElements) {<br>        if (mCurrentImagePosition != mOriginalImagePosition) {<br>            View sharedView = getImageAtPosition(mCurrentImagePosition);<br>            names.clear();<br>            sharedElements.clear();<br>            names.add(sharedView.getTransitionName());<br>            sharedElements.put(sharedView.getTransitionName(), sharedView);<br>        }<br>    }</string,></string></p>
<pre><code>/**
 * Returns the image of interest to be used as the entering/returning
 * shared element during the activity transition.
 */
private View getImageAtPosition(int position) {
    // ...
}
</code></pre><p>};</p>
<p>For a more complete solution, I have created a sample project on GitHub that will achieve this effect (there is too much code to post in a single StackOverflow answer).</p>
<p>问题具体地址：<br><a href="http://stackoverflow.com/questions/27304834/viewpager-fragments-shared-element-transitions" target="_blank" rel="external">http://stackoverflow.com/questions/27304834/viewpager-fragments-shared-element-transitions</a></p>
<p>项目github：<br><a href="https://github.com/alexjlockwood/activity-transitions" target="_blank" rel="external">https://github.com/alexjlockwood/activity-transitions</a></p>
<p>项目部分代码：<br>MainActivity:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">private final SharedElementCallback mCallback = new SharedElementCallback() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onMapSharedElements(List&lt;String&gt; names, Map&lt;String, View&gt; sharedElements) &#123;</span><br><span class="line">            if (mTmpReenterState != null) &#123;</span><br><span class="line">                int startingPosition = mTmpReenterState.getInt(EXTRA_STARTING_ALBUM_POSITION);</span><br><span class="line">                int currentPosition = mTmpReenterState.getInt(EXTRA_CURRENT_ALBUM_POSITION);</span><br><span class="line">                if (startingPosition != currentPosition) &#123;</span><br><span class="line">                    // If startingPosition != currentPosition the user must have swiped to a</span><br><span class="line">                    // different page in the DetailsActivity. We must update the shared element</span><br><span class="line">                    // so that the correct one falls into place.</span><br><span class="line">                    //需要改动共享元素</span><br><span class="line">                    String newTransitionName = ALBUM_NAMES[currentPosition];</span><br><span class="line">                    View newSharedElement = mRecyclerView.findViewWithTag(newTransitionName);</span><br><span class="line">                    if (newSharedElement != null) &#123;</span><br><span class="line">                        //清空再添加</span><br><span class="line">                        names.clear();</span><br><span class="line">                        names.add(newTransitionName);</span><br><span class="line">                        //清空再添加</span><br><span class="line">                        sharedElements.clear();</span><br><span class="line">                        sharedElements.put(newTransitionName, newSharedElement);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                mTmpReenterState = null;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                // If mTmpReenterState is null, then the activity is exiting.</span><br><span class="line">                View navigationBar = findViewById(android.R.id.navigationBarBackground);</span><br><span class="line">                View statusBar = findViewById(android.R.id.statusBarBackground);</span><br><span class="line">                if (navigationBar != null) &#123;</span><br><span class="line">                    //name和sharedElements都添加</span><br><span class="line">                    names.add(navigationBar.getTransitionName());</span><br><span class="line">                    sharedElements.put(navigationBar.getTransitionName(), navigationBar);</span><br><span class="line">                &#125;</span><br><span class="line">                if (statusBar != null) &#123;</span><br><span class="line">                    //name和sharedElements都添加</span><br><span class="line">                    names.add(statusBar.getTransitionName());</span><br><span class="line">                    sharedElements.put(statusBar.getTransitionName(), statusBar);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">@Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        //退出</span><br><span class="line">        setExitSharedElementCallback(mCallback);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>DetailActivity:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">private final SharedElementCallback mCallback = new SharedElementCallback() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onMapSharedElements(List&lt;String&gt; names, Map&lt;String, View&gt; sharedElements) &#123;</span><br><span class="line">            if (mIsReturning) &#123;</span><br><span class="line">                ImageView sharedElement = mCurrentDetailsFragment.getAlbumImage();</span><br><span class="line">                if (sharedElement == null) &#123;</span><br><span class="line">                    // If shared element is null, then it has been scrolled off screen and</span><br><span class="line">                    // no longer visible. In this case we cancel the shared element transition by</span><br><span class="line">                    // removing the shared element from the shared elements map.</span><br><span class="line">                    //共享元素不在屏幕内</span><br><span class="line">                    names.clear();</span><br><span class="line">                    sharedElements.clear();</span><br><span class="line">                &#125; else if (mStartingPosition != mCurrentPosition) &#123;</span><br><span class="line">                    // If the user has swiped to a different ViewPager page, then we need to</span><br><span class="line">                    // remove the old shared element and replace it with the new shared element</span><br><span class="line">                    // that should be transitioned instead.</span><br><span class="line">                    //替换旧的共享元素</span><br><span class="line">                    names.clear();</span><br><span class="line">                    names.add(sharedElement.getTransitionName());</span><br><span class="line">                    sharedElements.clear();</span><br><span class="line">                    sharedElements.put(sharedElement.getTransitionName(), sharedElement);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"> @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        //viewpager</span><br><span class="line">        setContentView(R.layout.activity_details);</span><br><span class="line">        postponeEnterTransition();</span><br><span class="line">        //进入</span><br><span class="line">        setEnterSharedElementCallback(mCallback);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>注意：By default, the activity transition framework will use the shared element that was used during the enter transition…<br>所以要动态的改变position，改变共享元素，通过两个activity间的通信，我们能够使得共享元素一致。<br><strong>碰到的问题</strong>：<br>项目中MainActivity和DetailsActivity都定义了共享元素的callback。从MainActivity到DetailActivity时，传递初始position，在DetailActivity中改变了position时，能够通过回调onActivityReenter方法将改变传给MainActivity，这样就能够保持共享元素一致了。在MainActivity的onCreate中只指明了<br>但是，我的启动方是fragment，并没有onActivityReenter方法，唯一可能有点关系的就是onActivityResult方法了，但是好像又不对。且包含我的fragment的activity又不容易获得。这样在DetailActivity中的变化始终不能够传递给我的fragment。<strong>怎么办呢？</strong><br>试验，测试看看在mainActivity中替换掉onActivityReenter方法为onActivityResult方法，如果替换后结果一致的话，就可以仿照着重写启动方fragment的onActivityResult方法，在这里面接受实时的position。但是试验结果显示不能替换：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">正常情况（只有onActivityReenter）：</span><br><span class="line">05-25 16:29:24.893 13109-13109/com.adp.activity.transitions I/main: start only</span><br><span class="line">05-25 16:29:31.910 13109-13109/com.adp.activity.transitions I/main: reenter</span><br><span class="line">05-25 16:29:31.934 13109-13109/com.adp.activity.transitions I/main: pos 7</span><br><span class="line">05-25 16:29:31.934 13109-13109/com.adp.activity.transitions I/main: name The King of Limbs</span><br><span class="line">05-25 16:29:37.298 13109-13109/com.adp.activity.transitions I/main: start only</span><br><span class="line">05-25 16:29:44.476 13109-13109/com.adp.activity.transitions I/main: reenter</span><br><span class="line">05-25 16:29:44.503 13109-13109/com.adp.activity.transitions I/main: pos 7</span><br><span class="line">05-25 16:29:44.504 13109-13109/com.adp.activity.transitions I/main: name The King of Limbs</span><br><span class="line"></span><br><span class="line">两个共存，直接崩溃：</span><br><span class="line">05-25 16:31:21.303 18200-18200/com.adp.activity.transitions I/main: start for result</span><br><span class="line">05-25 16:31:27.477 18200-18200/com.adp.activity.transitions I/main: reenter</span><br><span class="line">05-25 16:31:27.527 18200-18200/com.adp.activity.transitions I/main: pos 7</span><br><span class="line">05-25 16:31:27.527 18200-18200/com.adp.activity.transitions I/main: name The King of Limbs</span><br><span class="line">05-25 16:31:28.149 18200-18200/com.adp.activity.transitions I/main: result</span><br><span class="line"></span><br><span class="line">只有onActivityResult,直接崩溃:</span><br><span class="line">05-25 16:32:56.581 18992-18992/com.adp.activity.transitions I/main: start for result</span><br><span class="line">05-25 16:33:01.017 19321-19409/? I/DomainManager(MiLinkSDK)(games): startResolve</span><br><span class="line">05-25 16:33:01.019 19321-19409/? I/DomainManager(MiLinkSDK)(games): startDefaultHostThread</span><br><span class="line">05-25 16:33:01.104 19321-19498/? W/DomainManager(MiLinkSDK)(games): domain [domain = migc.g.mi.com,ip = 120.134.33.238,client localDNS = [none,none;202.204.48.6;202.204.60.10], errCode=0,timecost = 79ms]</span><br><span class="line">05-25 16:33:03.128 18992-18992/com.adp.activity.transitions I/main: result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">测试log：</span><br><span class="line">Log.i(&quot;main&quot;,&quot;start only&quot;);</span><br><span class="line">startActivity(intent,bundle);</span><br><span class="line">Log.i(&quot;main&quot;,&quot;start for result&quot;);</span><br><span class="line">startActivityForResult(intent, 1, bundle);</span><br></pre></td></tr></table></figure>
<p>关于tint（和颜色有关）：<br><a href="http://blog.csdn.net/u010687392/article/details/47399719" target="_blank" rel="external">http://blog.csdn.net/u010687392/article/details/47399719</a></p>
<p>在xml中配置android:transitionGroup=”true”应该是在transition时将其看做整体部分。</p>
<p>android中xml <strong>tools属性详解</strong>：<br><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0309/2567.html" target="_blank" rel="external">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0309/2567.html</a></p>
<p>完美解决android studio 关于中文乱码的问题：<br><a href="http://www.androidchina.net/3024.html" target="_blank" rel="external">http://www.androidchina.net/3024.html</a></p>
<p>关于<strong>onActivityReenter</strong>方法：<br>Called when an activity you launched with an activity transition exposes this Activity through a returning activity transition, giving you the resultCode and any additional data from it. This method will only be called if the activity set a result code other than RESULT_CANCELED and it supports activity transitions with FEATURE_ACTIVITY_TRANSITIONS.</p>
<p>The <strong>purpose</strong> of this function is <strong>to let the called Activity send a hint about its state so that this underlying Activity can prepare to be exposed</strong>. A call to this method does not guarantee that the called Activity has or will be exiting soon. It only indicates that it will expose this Activity’s Window and it has some data to pass to prepare it.</p>
<p><strong>跟我问题一样</strong>：<br><a href="https://github.com/alexjlockwood/activity-transitions/issues/2" target="_blank" rel="external">https://github.com/alexjlockwood/activity-transitions/issues/2</a></p>
<p><strong>可以看看</strong>：<br><a href="https://70kg.info/2015/11/05/SharedElement%E7%9A%84%E4%BD%BF%E7%94%A8/" target="_blank" rel="external">https://70kg.info/2015/11/05/SharedElement%E7%9A%84%E4%BD%BF%E7%94%A8/</a><br><a href="http://www.yzjingying.net/4655428014.htm" target="_blank" rel="external">http://www.yzjingying.net/4655428014.htm</a><br><a href="http://www.yzjingying.net/561628986.htm" target="_blank" rel="external">http://www.yzjingying.net/561628986.htm</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2016/05/13/妹知-源码解读/" data-title="妹知-源码解读 | 曾先生&#39;s Blog" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/05/16/COURSERA机器学习笔记1/" title="COURSERA机器学习笔记1">
  <strong>上一篇：</strong><br/>
  <span>
  COURSERA机器学习笔记1</span>
</a>
</div>


<div class="next">
<a href="/2016/05/12/PHP开发APP接口/"  title="PHP开发APP接口">
 <strong>下一篇：</strong><br/> 
 <span>PHP开发APP接口
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/05/13/妹知-源码解读/" data-title="妹知-源码解读" data-url="http://yoursite.com/2016/05/13/妹知-源码解读/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  

  
  <div class="tagcloudlist">
    <p class="asidetitle">Tag Cloud</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Java编程思想读书笔记/" style="font-size: 17.14px;">Java编程思想读书笔记</a> <a href="/tags/TECH/" style="font-size: 12.86px;">TECH</a> <a href="/tags/后端开发/" style="font-size: 18.57px;">后端开发</a> <a href="/tags/数据结构与算法分析/" style="font-size: 11.43px;">数据结构与算法分析</a> <a href="/tags/机器学习/" style="font-size: 14.29px;">机器学习</a> <a href="/tags/程序人生/" style="font-size: 10px;">程序人生</a> <a href="/tags/程序员修炼之道读书笔记/" style="font-size: 14.29px;">程序员修炼之道读书笔记</a> <a href="/tags/算法4读书笔记/" style="font-size: 15.71px;">算法4读书笔记</a>
    </div>
  </div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="http://lucida.me/" target="_blank" title="Lucida&#39;s Blog">Lucida&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="http://hukai.me/" target="_blank" title="Hukai&#39;s Blog">Hukai&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="http://gank.io/" target="_blank" title="GANK">GANK</a>
            
          </li>
        
          <li>
            
            	<a href="http://stormzhang.com/" target="_blank" title="StormZhang&#39;s Blog">StormZhang&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.trinea.cn/" target="_blank" title="Trinea&#39;s Blog">Trinea&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=2766fecb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello , I&#39;m Zeng Qi , a Android developer , love Java , ML and Big Data . <br/>
			This is my blog , hope you will enjoy it . Let&#39;s make this world a better place .</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/18600103348" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/zengqi-ustb" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		<a href="http://www.zhihu.com/people/ceng-qi-29" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:zengqiustb@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		© 2016 
		
		<a href="/about" target="_blank" title="曾奇">曾奇</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"zengqi"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
