
 <!DOCTYPE HTML>
<html lang="default">
<head>
  <meta charset="UTF-8">
  
    <title>SpringBoot+Thymeleaf+iBatis开发项目 | 曾先生&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="曾奇">
    

    
    <meta name="description" content="maven该项目为maven项目，在我的一台电脑上配置好的项目copy到另一台电脑上，maven貌似需要重新下载maven依赖，maven项目必须联网吗？
参考1：Maven installation and using in project without Internet conncetion，该文表示如果在offline状态下用本地的库使用maven，就背离了maven的原则，maven在原">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot+Thymeleaf+iBatis开发项目">
<meta property="og:url" content="http://yoursite.com/2017/02/24/SpringBoot+Thymeleaf+iBatis开发项目/index.html">
<meta property="og:site_name" content="曾先生's Blog">
<meta property="og:description" content="maven该项目为maven项目，在我的一台电脑上配置好的项目copy到另一台电脑上，maven貌似需要重新下载maven依赖，maven项目必须联网吗？
参考1：Maven installation and using in project without Internet conncetion，该文表示如果在offline状态下用本地的库使用maven，就背离了maven的原则，maven在原">
<meta property="og:updated_time" content="2017-03-18T15:05:12.979Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SpringBoot+Thymeleaf+iBatis开发项目">
<meta name="twitter:description" content="maven该项目为maven项目，在我的一台电脑上配置好的项目copy到另一台电脑上，maven貌似需要重新下载maven依赖，maven项目必须联网吗？
参考1：Maven installation and using in project without Internet conncetion，该文表示如果在offline状态下用本地的库使用maven，就背离了maven的原则，maven在原">

    
    <link rel="alternative" href="/atom.xml" title="曾先生&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="曾先生&#39;s Blog" title="曾先生&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="曾先生&#39;s Blog">曾先生&#39;s Blog</a></h1>
				<h2 class="blog-motto">飞面神教四川担担面教区主教</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于我</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/02/24/SpringBoot+Thymeleaf+iBatis开发项目/" title="SpringBoot+Thymeleaf+iBatis开发项目" itemprop="url">SpringBoot+Thymeleaf+iBatis开发项目</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="曾奇" target="_blank" itemprop="author">曾奇</a>
		
  <p class="article-time">
    <time datetime="2017-02-24T04:30:33.000Z" itemprop="datePublished"> Published 2017-02-24</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#maven"><span class="toc-number">1.</span> <span class="toc-text">maven</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Thymeleaf"><span class="toc-number">2.</span> <span class="toc-text">Thymeleaf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iBatis"><span class="toc-number">3.</span> <span class="toc-text">iBatis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#入门"><span class="toc-number">4.</span> <span class="toc-text">入门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XML-映射配置文件"><span class="toc-number">5.</span> <span class="toc-text">XML 映射配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mapper-XML-文件"><span class="toc-number">6.</span> <span class="toc-text">Mapper XML 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态-SQL"><span class="toc-number">7.</span> <span class="toc-text">动态 SQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java-API"><span class="toc-number">8.</span> <span class="toc-text">Java API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL语句构建器类"><span class="toc-number">9.</span> <span class="toc-text">SQL语句构建器类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更多"><span class="toc-number">10.</span> <span class="toc-text">更多</span></a></li></ol>
		
		</div>
		
		<h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><p>该项目为maven项目，在我的一台电脑上配置好的项目copy到另一台电脑上，maven貌似需要重新下载maven依赖，<strong>maven项目必须联网吗</strong>？</p>
<p>参考1：<a href="http://stackoverflow.com/questions/6609443/maven-installation-and-using-in-project-without-internet-conncetion" target="_blank" rel="external">Maven installation and using in project without Internet conncetion</a>，该文表示如果在offline状态下用本地的库使用maven，就背离了maven的原则，maven在原则下就是需要联网的，这样才能精确和更好地控制版本。</p>
<p>参考2：<a href="http://stackoverflow.com/questions/7233328/how-do-i-configure-maven-for-offline-development" target="_blank" rel="external">How do I configure Maven for offline development?</a></p>
<p>参考3：<a href="http://blog.csdn.net/hephec/article/details/53418906" target="_blank" rel="external">maven联网问题</a>，如果真的需要使用本地仓库就这样做。</p>
<h2 id="Thymeleaf"><a href="#Thymeleaf" class="headerlink" title="Thymeleaf"></a>Thymeleaf</h2><p>在学习新技术之前，首先需要明白的问题是：</p>
<p>1.<strong>它解决了什么问题？</strong><br>2.<strong>它跟与它类似的技术有什么优劣？</strong></p>
<p><strong>学习的一个重大途径是看FAQ！从经常问的问题中寻找答案！</strong></p>
<p>参考<a href="http://www.thymeleaf.org/faq.html" target="_blank" rel="external">thymeleaf FAQ</a>，一些精华：</p>
<p>1.<a href="http://www.thymeleaf.org/faq.html#is-web-framework" target="_blank" rel="external">Is Thymeleaf a web framework?</a>：</p>
<p><strong>No, it isn’t. It is a template engine.</strong></p>
<p>Template engines play a key role in web frameworks, though, and are one of its most important components as they are in charge of producing the user interface or view layer (usually in XHTML or HTML form).</p>
<p>Spring MVC, Struts or Apache Wicket are examples of web frameworks, whereas <strong>JSP, Velocity or FreeMarker are examples of template engines</strong>.</p>
<p>2.<a href="http://www.thymeleaf.org/faq.html#what-types-of-templates" target="_blank" rel="external">What types of templates can Thymeleaf process?</a>：</p>
<p>Thymeleaf templates can be:</p>
<p>1.HTML (HTML5, XHTML 1.0/1.1, HTML 4)<br>2.XML<br>3.TEXT (plain text)<br>4.JAVASCRIPT (.js files)<br>5.CSS (.css files)</p>
<p>3.<a href="http://www.thymeleaf.org/faq.html#no-spring-can-I-use" target="_blank" rel="external">I don’t use Spring at all. Can I still use Thymeleaf?</a>：</p>
<p>Absolutely. Thymeleaf offers nice integration with Spring MVC through its SpringStandard dialect (included in the thymeleaf-spring3, thymeleaf-spring4 and thymeleaf-spring5 packages), but Spring integration is completely optional and the Standard dialect is in fact meant to be used without Spring.</p>
<p>4.<a href="http://www.thymeleaf.org/faq.html#compare-other-engines" target="_blank" rel="external">How does Thymeleaf compare with other template engines like Velocity or FreeMarker?</a>：</p>
<p>Both Velocity and FreeMarker are terrific pieces of software, but they approach the templating problem with a philosophy quite different to that of Thymeleaf.</p>
<p>Thymeleaf makes a strong stress on natural templating —allowing templates to be working prototypes, which the other two do not allow—, and its syntax tries to be (arguably) cleaner and more in tune with the current trends in web development. Also, from an architectural standpoint, both Velocity and FreeMarker work as sequential text processors whereas Thymeleaf is based on markup parsing techniques. This allows Thymeleaf to take advantage of interesting features specific to markup-based environments, especially the web.</p>
<p>Anyway, the best way to compare these technologies is to use them yourself and feel which one suits you best.</p>
<p>带着上述问题，我们来看thymeleaf：</p>
<p>首先，它解决什么问题？从FAQ中可以很清楚地看出来，它是一款后端的模板引擎，那么它的大部分功能应该是实现动态填值的功能！</p>
<p>之前的jsp也能实现相应的功能，那么它与jsp比较有哪些优劣呢？</p>
<p>参考：<a href="http://www.thymeleaf.org/doc/articles/thvsjsp.html" target="_blank" rel="external">Spring MVC view layer: Thymeleaf vs. JSP</a>：</p>
<p>thymeleaf的标签都是以th开头的，如<code>th:href</code> 。</p>
<p>比较重点可以看看<code>4.Let’s change the page style!</code>这一节：</p>
<p>1.对于jsp：需要先将jsp部署到服务器上然后启动，没有服务器，jsp是不能正常工作的。打开浏览器的dev tools，然后一个一个颜色试，将最终颜色写入css，完成。</p>
<p>2.对于thymeleaf：直接浏览器打开该html文件，打开浏览器的dev tools，然后一个一个颜色试，然后存入css，完成。</p>
<p>上述是跟jsp的优势。</p>
<p>接下来我们来了解下<a href="http://www.thymeleaf.org/doc/articles/standarddialect5minutes.html" target="_blank" rel="external">thymeleaf的基础</a>：</p>
<p>一、Thymeleaf is very, very extensible, and <strong>it allows you to define your own sets of template attributes (or even tags) with the names you want</strong>, evaluating the expressions you want in the syntax you want and applying the logic you want. <strong>It’s more like a template engine framework</strong>.</p>
<p>二、五种<strong>Standard Expressions</strong>:</p>
<p>1.${…} : Variable expressions.<br>2.*{…} : Selection expressions.<br>3.#{…} : Message (i18n) expressions.<br>4.@{…} : Link (URL) expressions.<br>5.~{…} : Fragment expressions.</p>
<p><em>Variable expressions</em></p>
<p>Variable expressions are executed on the context variables — also called <em>model attributes</em> in Spring jargon.</p>
<p>And you will find them as <strong>attribute values</strong> or as a part of them, depending on the attribute:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span th:text=&quot;$&#123;book.author.name&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>The expression above is equivalent (both in OGNL and SpringEL) to:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((Book)context.getVariable(&quot;book&quot;)).getAuthor().getName()</span><br></pre></td></tr></table></figure>
<p>当然还有可能有一些高级的用法，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;li th:each=&quot;book : $&#123;books&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>Here ${books} selects the variable called books from the context, and evaluates it as an iterable to be used at a th:each loop.</p>
<p><em>Selection expressions</em></p>
<p>Selection expressions跟variable expressions很相似，不同点是，Selection expressions作用在a previously selected object，而不是the whole context variables map（variable expressions应该是作用在其上的）。</p>
<p>The object they act on is specified by a <code>th:object</code> attribute，用法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div th:object=&quot;$&#123;book&#125;&quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;span th:text=&quot;*&#123;title&#125;&quot;&gt;...&lt;/span&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>上述写法相当于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  // th:object=&quot;$&#123;book&#125;&quot;</span><br><span class="line">  final Book selection = (Book) context.getVariable(&quot;book&quot;);</span><br><span class="line">  // th:text=&quot;*&#123;title&#125;&quot;</span><br><span class="line">  output(selection.getTitle());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>Message (i18n) expressions</em></p>
<p>Message expressions主要是用来<strong>国际化</strong>的。</p>
<p>it allows us to retrieve locale-specific messages from external sources (<strong>.properties files</strong>), referencing them by a key and (optionally) applying a set of parameters.</p>
<p><em>Link (URL) expressions</em></p>
<p>Link expressions are <strong>meant to build URLs and add useful context and session info to them (a process usually called URL rewriting)</strong>.</p>
<p>举例来说：<br>1.So for a web application deployed at the <strong>/myapp</strong> context of your web server, an expression such as:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a th:href=&quot;@&#123;/order/list&#125;&quot;&gt;...&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p>也就是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;/myapp/order/list&quot;&gt;...&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p>2.URL也可以带上参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a th:href=&quot;@&#123;/order/details(id=$&#123;orderId&#125;,type=$&#123;orderType&#125;)&#125;&quot;&gt;...&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p>也就是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Note ampersands (&amp;) should be HTML-escaped in tag attributes... --&gt;</span><br><span class="line">&lt;a href=&quot;/myapp/order/details?id=23&amp;amp;type=online&quot;&gt;...&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p>3.当然，链接也可以是绝对的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a th:href=&quot;@&#123;http://www.mycompany.com/main&#125;&quot;&gt;...&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p><em>Fragment expressions</em></p>
<p>Fragment expressions are <strong>an easy way to represent fragments of markup and move them around templates</strong>. Thanks to these expressions, fragments can be replicated, passed to other templates are arguments, and so on.</p>
<p>The most common use is for fragment insertion using <strong>th:insert</strong> or <strong>th:replace</strong>，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.</span><br><span class="line">&lt;div th:insert=&quot;~&#123;commons :: main&#125;&quot;&gt;...&lt;/div&gt;</span><br><span class="line">2.</span><br><span class="line">&lt;div th:with=&quot;frag=~&#123;footer :: #main/text()&#125;&quot;&gt;</span><br><span class="line">  &lt;p th:insert=&quot;$&#123;frag&#125;&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p><em>Literals and operations</em></p>
<p>三、Some basic attributes</p>
<p><code>th:text</code>的作用是just replaces the body of a tag：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p th:text=&quot;#&#123;msg.welcome&#125;&quot;&gt;Welcome everyone!&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<p><code>th:each</code>的用法是做循环嘛：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;li th:each=&quot;book : $&#123;books&#125;&quot; th:text=&quot;$&#123;book.title&#125;&quot;&gt;En las Orillas del Sar&lt;/li&gt;</span><br></pre></td></tr></table></figure>
<p>在thymeleaf中进行引用时，比如上面的books，我们怎样往里面赋值，然后html界面才能够引用呢？我们可以这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@ModelAttribute(&quot;allTypes&quot;)</span><br><span class="line">public List&lt;Type&gt; populateTypes() &#123;</span><br><span class="line">    return Arrays.asList(Type.ALL);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">@ModelAttribute(&quot;allFeatures&quot;)</span><br><span class="line">public List&lt;Feature&gt; populateFeatures() &#123;</span><br><span class="line">    return Arrays.asList(Feature.ALL);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">@ModelAttribute(&quot;allVarieties&quot;)</span><br><span class="line">public List&lt;Variety&gt; populateVarieties() &#123;</span><br><span class="line">    return this.varietyService.findAll();</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">@ModelAttribute(&quot;allSeedStarters&quot;)</span><br><span class="line">public List&lt;SeedStarter&gt; populateSeedStarters() &#123;</span><br><span class="line">    return this.seedStarterService.findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们就可以在界面中引用了，当然也可以使用<code>model.add方法</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;tr th:each=&quot;sb : $&#123;allSeedStarters&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>更多请参考：<a href="http://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html" target="_blank" rel="external">Tutorial: Thymeleaf + Spring</a></p>
<p>关于程序与view的数据交互<br>参考：<a href="http://www.thymeleaf.org/doc/articles/springmvcaccessdata.html" target="_blank" rel="external">Spring MVC and Thymeleaf: how to access data from templates</a></p>
<p><strong>In a typical Spring MVC application, @Controller classes are responsible for preparing a model map with data and selecting a view to be rendered</strong>. This model map allows for the complete abstraction of the view technology and, in the case of Thymeleaf, it is transformed into a Thymeleaf context object (part of the Thymeleaf template execution context) that makes all the defined variables available to expressions executed in templates.</p>
<p>在SpringMVC项目中，通常情况下，@Controller类负责将data传入给model，然后由model将数带入view中。</p>
<p><em>1.Spring model attributes</em></p>
<p>Spring MVC calls the pieces of data that can be accessed during the execution of views <em>model attributes</em> . <strong>注意，是在views运行期间能够获取的数据！</strong> 也即model数据是跟views相关的。</p>
<p>The equivalent term in Thymeleaf language is <em>context variables</em>.相似术语。</p>
<p>有三种方式向model中加入内容：</p>
<p>1.Add attribute to Model via its <strong>addAttribute</strong> method:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;message&quot;, method = RequestMethod.GET)</span><br><span class="line">    public String messages(Model model) &#123;</span><br><span class="line">        model.addAttribute(&quot;messages&quot;, messageRepository.findAll());</span><br><span class="line">        return &quot;message/list&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>2.Return <strong>ModelAndView</strong> with model attributes included:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;message&quot;, method = RequestMethod.GET)</span><br><span class="line">    public ModelAndView messages() &#123;</span><br><span class="line">        ModelAndView mav = new ModelAndView(&quot;message/list&quot;);</span><br><span class="line">        mav.addObject(&quot;messages&quot;, messageRepository.findAll());</span><br><span class="line">        return mav;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>3.Expose common attributes via methods annotated with <strong>@ModelAttribute</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@ModelAttribute(&quot;messages&quot;)</span><br><span class="line">    public List&lt;Message&gt; messages() &#123;</span><br><span class="line">        return messageRepository.findAll();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>In Thymeleaf, these <em>model attributes</em> (or <em>context variables</em> in Thymeleaf jargon) can be accessed with the following syntax: <em>${attributeName}</em>, where attributeName in our case is <strong>messages</strong>，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;tr th:each=&quot;message : $&#123;messages&#125;&quot;&gt;</span><br><span class="line">        &lt;td th:text=&quot;$&#123;message.id&#125;&quot;&gt;1&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&lt;a href=&quot;#&quot; th:text=&quot;$&#123;message.title&#125;&quot;&gt;Title ...&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">        &lt;td th:text=&quot;$&#123;message.text&#125;&quot;&gt;Text ...&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br></pre></td></tr></table></figure>
<p><em>2.Request parameters</em></p>
<p>比如一个网址：<code>https://example.com/query?q=Thymeleaf+Is+Great!</code></p>
<p>可以通过param来获取q：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p th:text=&quot;$&#123;param.q&#125;&quot;&gt;Test&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<p>如果q有多值，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://example.com/query?q=Thymeleaf%20Is%20Great!&amp;q=Really%3F</span><br></pre></td></tr></table></figure>
<p>可以采用数组这样得到：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p th:text=&quot;$&#123;param.q[0] + &apos; &apos; + param.q[1]&#125;&quot; th:unless=&quot;$&#123;param.q == null&#125;&quot;&gt;Test&lt;/p&gt;</span><br></pre></td></tr></table></figure></p>
<p><em>3.Session attributes</em></p>
<p>In the below example we add <strong>mySessionAttribute</strong> to session:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&#123;&quot;/&quot;&#125;)</span><br><span class="line">    String index(HttpSession session) &#123;</span><br><span class="line">        session.setAttribute(&quot;mySessionAttribute&quot;, &quot;someValue&quot;);</span><br><span class="line">        return &quot;index&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>获取方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//方法1</span><br><span class="line">&lt;p th:text=&quot;$&#123;session.mySessionAttribute&#125;&quot; th:unless=&quot;$&#123;session == null&#125;&quot;&gt;[...]&lt;/p&gt;</span><br><span class="line">//方法2</span><br><span class="line">$&#123;#session.getAttribute(&apos;mySessionAttribute&apos;)&#125;</span><br></pre></td></tr></table></figure>
<p><em>4.ServletContext attributes</em></p>
<p>The <strong>ServletContext</strong> attributes are shared <strong>between requests and sessions</strong>. In order to access ServletContext attributes in Thymeleaf you can use the <strong>#servletContext.</strong> prefix:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;table&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;My context attribute&lt;/td&gt;</span><br><span class="line">                &lt;!-- Retrieves the ServletContext attribute &apos;myContextAttribute&apos; --&gt;</span><br><span class="line">                &lt;td th:text=&quot;$&#123;#servletContext.getAttribute(&apos;myContextAttribute&apos;)&#125;&quot;&gt;42&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr th:each=&quot;attr : $&#123;#servletContext.getAttributeNames()&#125;&quot;&gt;</span><br><span class="line">                &lt;td th:text=&quot;$&#123;attr&#125;&quot;&gt;javax.servlet.context.tempdir&lt;/td&gt;</span><br><span class="line">                &lt;td th:text=&quot;$&#123;#servletContext.getAttribute(attr)&#125;&quot;&gt;/tmp&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/table&gt;</span><br></pre></td></tr></table></figure>
<p><em>5.Spring beans</em></p>
<p>Thymeleaf allows accessing beans registered at the Spring Application Context with the <strong>@beanName</strong> syntax, for example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div th:text=&quot;$&#123;@urlService.getApplicationUrl()&#125;&quot;&gt;...&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>In the above example, @urlService refers to a Spring Bean registered at your context, e.g.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">    public class MyConfiguration &#123;</span><br><span class="line">        @Bean(name = &quot;urlService&quot;)</span><br><span class="line">        public UrlService urlService() &#123;</span><br><span class="line">            return () -&gt; &quot;domain.com/myapp&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public interface UrlService &#123;</span><br><span class="line">        String getApplicationUrl();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>数据从程序到view可以走model进行数据交换，那么从view到程序呢？</p>
<p>按我的理解来强答这个问题，client通过http协议，要求访问某个url，server通过定义的controller来进行运算，加载数据进入model，然后model将数据填入html页面中，渲染之后，返回给client。所以可以有model到view这条路，view到程序可以传值可以由client通过http url给server，我想也可以定义所谓的回调函数吧，当然，这也只是猜测。不管怎样，前端数据的改变只有通过http等协议才能传递给后端吧。</p>
<h2 id="iBatis"><a href="#iBatis" class="headerlink" title="iBatis"></a>iBatis</h2><p>参考<a href="http://www.mybatis.org/mybatis-3/zh/index.html" target="_blank" rel="external">iBatis docs</a>，居然有中文版的docs，感谢翻译人士。</p>
<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><p>它是一款持久层的框架。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以对配置和原生Map使用简单的 XML 或注解，将接口和 Java 的 POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。</p>
<p><em>1.构建SqlSessionFactory</em></p>
<p>有两种方式：</p>
<p><strong>1.使用XML</strong></p>
<p><strong>每个基于 MyBatis 的应用都是以一个 SqlSessionFactory 的实例为中心的</strong>。SqlSessionFactory 的实例可以通过 SqlSessionFactoryBuilder 获得。而 SqlSessionFactoryBuilder 则可以从 XML 配置文件或一个预先定制的 Configuration 的实例构建出 SqlSessionFactory 的实例。</p>
<p>MyBatis 包含一个名叫 Resources 的工具类，它包含一些实用方法，可使从 classpath 或其他位置加载资源文件更加容易。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String resource = &quot;org/mybatis/example/mybatis-config.xml&quot;;</span><br><span class="line">InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);</span><br></pre></td></tr></table></figure>
<p>XML 配置文件（configuration XML）中包含了对 MyBatis 系统的核心设置，包含获取数据库连接实例的数据源（DataSource）和决定事务作用域和控制方式的事务管理器（TransactionManager）。示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">    &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">      &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line">      &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</span><br><span class="line">      &lt;/dataSource&gt;</span><br><span class="line">    &lt;/environment&gt;</span><br><span class="line">  &lt;/environments&gt;</span><br><span class="line">  &lt;mappers&gt;</span><br><span class="line">    &lt;mapper resource=&quot;org/mybatis/example/BlogMapper.xml&quot;/&gt;</span><br><span class="line">  &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<p><strong>2.使用java代码配置</strong></p>
<p>比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DataSource dataSource = BlogDataSourceFactory.getBlogDataSource();</span><br><span class="line">TransactionFactory transactionFactory = new JdbcTransactionFactory();</span><br><span class="line">Environment environment = new Environment(&quot;development&quot;, transactionFactory, dataSource);</span><br><span class="line">Configuration configuration = new Configuration(environment);</span><br><span class="line">configuration.addMapper(BlogMapper.class);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(configuration);</span><br></pre></td></tr></table></figure>
<p>注意该例中，configuration 添加了一个映射器类（mapper class）。<strong>映射器类是 Java 类，它们包含 SQL 映射语句的注解从而避免了 XML 文件的依赖</strong>。不过，由于 Java 注解的一些限制加之某些 MyBatis 映射的复杂性，<strong>XML 映射对于大多数高级映射（比如：嵌套 Join 映射）来说仍然是必须的</strong>。有鉴于此，如果存在一个对等的 XML 配置文件的话，MyBatis 会自动查找并加载它（这种情况下， BlogMapper.xml 将会基于类路径和 BlogMapper.class 的类名被加载进来）。<strong>有对应的xml文件会被优先加载</strong>。</p>
<p><em>2.从 SqlSessionFactory 中获取 SqlSession</em></p>
<p><strong>SqlSession 完全包含了面向数据库执行 SQL 命令所需的所有方法</strong>。你可以通过 SqlSession 实例来直接执行已映射的 SQL 语句。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">try &#123;</span><br><span class="line">  Blog blog = (Blog) session.selectOne(&quot;org.mybatis.example.BlogMapper.selectBlog&quot;, 101);</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">  session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码的写法是旧式的，现在有了更新的写法。<strong>使用对于给定语句能够合理描述参数和返回值的接口（比如说BlogMapper.class），你现在不但可以执行更清晰和类型安全的代码，而且还不用担心易错的字符串字面值以及强制类型转换</strong>。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">try &#123;</span><br><span class="line">  BlogMapper mapper = session.getMapper(BlogMapper.class);</span><br><span class="line">  Blog blog = mapper.selectBlog(101);</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">  session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>3.探究已映射的 SQL 语句</em></p>
<p>我们来探究一下上述代码到底是怎么正确执行的。</p>
<p>这里给出一个基于 XML 映射语句的示例，它应该可以满足上述示例中 SqlSession 的调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">  PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">  &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;org.mybatis.example.BlogMapper&quot;&gt;</span><br><span class="line">  &lt;select id=&quot;selectBlog&quot; resultType=&quot;Blog&quot;&gt;</span><br><span class="line">    select * from Blog where id = #&#123;id&#125;</span><br><span class="line">  &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
<p>使用方式一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Blog blog = (Blog) session.selectOne(&quot;org.mybatis.example.BlogMapper.selectBlog&quot;, 101);</span><br></pre></td></tr></table></figure>
<p><strong>注意到这和使用完全限定名调用 Java 对象的方法是相似的</strong>。这个命名可以直接映射到在命名空间中同名的 Mapper 类，并在已映射的 select 语句中的名字、参数和返回类型匹配成方法。简而言之，就是配置xml生成了对应的java代码。所以有了使用方式二：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BlogMapper mapper = session.getMapper(BlogMapper.class);</span><br><span class="line">Blog blog = mapper.selectBlog(101);</span><br></pre></td></tr></table></figure>
<p>关于命名空间（namespace）：<br>参考1：<a href="http://stackoverflow.com/questions/3384204/what-are-namespaces" target="_blank" rel="external">What are namespaces?</a></p>
<p>它的主要作用就是避免同名的方法或者类在被调用时无法区分的问题（不然只有改名）。同时，它也避免了自己项目的代码和第三方代码同名的尴尬。</p>
<p>If we didn’t have namespaces we’d have to (potentially) change a lot of code any time we added a library, or come up with tedious prefixes to make our function names unique. <strong>With namespaces, we can avoid the headache of naming collisions when mixing third-party code with our own projects</strong>.</p>
<p>对于像 BlogMapper 这样的映射器类（Mapper class）来说，它们的映射的语句可以不需要用 XML 来做，取而代之的是可以使用 Java 注解。<strong>映射器类也可以使用java代码配置</strong>。比如，上面的 XML 示例可被替换如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package org.mybatis.example;</span><br><span class="line">public interface BlogMapper &#123;</span><br><span class="line">  @Select(&quot;SELECT * FROM blog WHERE id = #&#123;id&#125;&quot;)</span><br><span class="line">  Blog selectBlog(int id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>4.作用域（Scope）和生命周期</em></p>
<p><strong>依赖注入框架可以创建线程安全的、基于事务的 SqlSession 和映射器（mapper）并将它们直接注入到你的 bean 中，因此可以直接忽略它们的生命周期</strong>。如果对如何通过依赖注入框架来使用 MyBatis 感兴趣可以研究一下 MyBatis-Spring 或 MyBatis-Guice 两个子项目。</p>
<p><strong>1.SqlSessionFactoryBuilder</strong></p>
<p>SqlSessionFactoryBuilder的作用就是创建SqlSessionFactory，因此该实例的最佳作用域就是<strong>方法作用域</strong>。你可以重用SqlSessionFactoryBuilder 来创建多个 SqlSessionFactory 实例，<strong>但是最好还是不要让其一直存在以保证所有的 XML 解析资源开放给更重要的事情</strong>。</p>
<p><strong>2.SqlSessionFactory</strong></p>
<p>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在，没有任何理由对它进行清除或重建。因此 SqlSessionFactory 的最佳作用域是<strong>应用作用域</strong>。有很多方法可以做到，最简单的就是使用<strong>单例模式或者静态单例模式</strong>。</p>
<p><strong>3.SqlSession</strong></p>
<p><strong>每个线程都应该有它自己的 SqlSession 实例</strong>。SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是<strong>请求或方法作用域</strong>。绝对不能将 SqlSession 实例的引用放在一个类的静态域，甚至一个类的实例变量也不行。也绝不能将 SqlSession 实例的引用放在任何类型的管理作用域中，比如 Serlvet 架构中的 HttpSession。<strong>如果你现在正在使用一种 Web 框架，要考虑 SqlSession 放在一个和 HTTP 请求对象相似的作用域中</strong>。换句话说，<strong>每次收到的 HTTP 请求，就可以打开一个 SqlSession，返回一个响应，就关闭它</strong>。这个关闭操作是很重要的，你应该把这个关闭操作放到 finally 块中以确保每次都能执行关闭。下面的示例就是一个确保 SqlSession 关闭的标准模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">try &#123;</span><br><span class="line">  // do work</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">  session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>4.映射器实例（Mapper Instances）</strong></p>
<p><strong>映射器是创建用来绑定映射语句的接口。映射器接口的实例是从 SqlSession 中获得的</strong>。因此从技术层面讲，映射器实例的最大作用域是和 SqlSession 相同的，因为它们都是从 SqlSession 里被请求的。尽管如此，映射器实例的最佳作用域是<strong>方法作用域</strong>。也就是说，映射器实例应该在调用它们的方法中被请求，用过之后即可废弃。并不需要显式地关闭映射器实例，尽管在整个请求作用域（request scope）保持映射器实例也不会有什么问题，但是很快你会发现，像 SqlSession 一样，在这个作用域上管理太多的资源的话会难于控制。所以要保持简单，最好把映射器放在方法作用域（method scope）内。下面的示例就展示了这个实践：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">try &#123;</span><br><span class="line">  BlogMapper mapper = session.getMapper(BlogMapper.class);</span><br><span class="line">  // do work</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">  session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="XML-映射配置文件"><a href="#XML-映射配置文件" class="headerlink" title="XML 映射配置文件"></a>XML 映射配置文件</h2><p>MyBatis 的配置文件包含了影响 MyBatis 行为甚深的<strong>设置（settings）</strong>和<strong>属性（properties）</strong>信息。</p>
<p>搞清楚设置和属性信息的区别。</p>
<p><em>1.properties</em></p>
<p>这些属性都是可外部配置且可动态替换的，既可以在典型的 Java 属性文件中配置，亦可通过 properties 元素的子元素来传递。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties resource=&quot;org/mybatis/example/config.properties&quot;&gt;</span><br><span class="line">  &lt;property name=&quot;username&quot; value=&quot;dev_user&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;password&quot; value=&quot;F2Fa3!33TYyg&quot;/&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>
<p>其中的属性就可以在整个配置文件中使用来替换需要动态配置的属性值。比如: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">  &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</span><br><span class="line">&lt;/dataSource&gt;</span><br></pre></td></tr></table></figure>
<p>动态值由 <strong>config.properties 文件</strong>中对应的值来替换。</p>
<p>如果属性在不只一个地方进行了配置，那么 MyBatis 将按照下面的顺序来加载（<strong>加载的优先顺序</strong>）：</p>
<p>1.在 properties 元素体内指定的属性首先被读取。<br>2.然后根据 properties 元素中的 resource 属性读取类路径下属性文件或根据 url 属性指定的路径读取属性文件，并覆盖已读取的同名属性。<br>3.最后读取作为方法参数传递的属性，并覆盖已读取的同名属性。</p>
<p>即是，<strong>通过方法参数传递的属性&gt;resource/url 属性中指定的配置文件&gt;properties 属性中指定的属性</strong>。</p>
<p>MyBatis 3.4.2开始，可以使用默认值来进行占位了，不过该属性默认是关闭的。</p>
<p><em>2.settings</em></p>
<p><strong>这是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为</strong>。具体的settings请参考：<a href="http://www.mybatis.org/mybatis-3/zh/configuration.html#settings" target="_blank" rel="external">settings</a></p>
<p><em>3.typeAliases</em></p>
<p><strong>类型别名是为 Java 类型设置一个短的名字。它只和 XML 配置有关，存在的意义仅在于用来减少类完全限定名的冗余</strong>。例如:</p>
<p>套路一：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Author&quot; type=&quot;domain.blog.Author&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Blog&quot; type=&quot;domain.blog.Blog&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Comment&quot; type=&quot;domain.blog.Comment&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Post&quot; type=&quot;domain.blog.Post&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Section&quot; type=&quot;domain.blog.Section&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Tag&quot; type=&quot;domain.blog.Tag&quot;/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure></p>
<p>当这样配置时，Blog可以用在任何使用domain.blog.Blog的地方。</p>
<p>套路二，也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean，比如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line">  &lt;package name=&quot;domain.blog&quot;/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure></p>
<p>每一个在包 domain.blog 中的 Java Bean，在没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名。 <strong>比如 domain.blog.Author 的别名为 author</strong>；若有注解，则别名为其注解值。看下面的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Alias(&quot;author&quot;)</span><br><span class="line">public class Author &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>套路三，许多常见的 Java 类型内建了相应的类型别名。<strong>它们都是大小写不敏感的</strong>，需要注意的是由基本类型名称重复导致的特殊处理。具体请参考：<a href="http://www.mybatis.org/mybatis-3/zh/configuration.html#typeAliases" target="_blank" rel="external">typeAliases</a></p>
<p><em>4.typeHandlers</em></p>
<p>无论是 MyBatis 在预处理语句（PreparedStatement）中设置一个参数时，还是从结果集中取出一个值时， 都会<strong>用类型处理器将获取的值以合适的方式转换成 Java 类型</strong>。下表描述了一些默认的类型处理器。</p>
<p>一些标准的java类型都有对应的类型处理器，请参考<a href="http://www.mybatis.org/mybatis-3/zh/configuration.html#typeHandlers" target="_blank" rel="external">typeHandlers</a></p>
<p>当然可以自定义类型处理器，具体做法是：<br>实现 org.apache.ibatis.type.TypeHandler 接口， 或继承一个很便利的类 org.apache.ibatis.type.BaseTypeHandler， 然后可以选择性地将它映射到一个 JDBC 类型。比如： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// ExampleTypeHandler.java</span><br><span class="line">@MappedJdbcTypes(JdbcType.VARCHAR)</span><br><span class="line">public class ExampleTypeHandler extends BaseTypeHandler&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public void setNonNullParameter(PreparedStatement ps, int i, String parameter, JdbcType jdbcType) throws SQLException &#123;</span><br><span class="line">    ps.setString(i, parameter);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public String getNullableResult(ResultSet rs, String columnName) throws SQLException &#123;</span><br><span class="line">    return rs.getString(columnName);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public String getNullableResult(ResultSet rs, int columnIndex) throws SQLException &#123;</span><br><span class="line">    return rs.getString(columnIndex);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public String getNullableResult(CallableStatement cs, int columnIndex) throws SQLException &#123;</span><br><span class="line">    return cs.getString(columnIndex);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- mybatis-config.xml --&gt;</span><br><span class="line">&lt;typeHandlers&gt;</span><br><span class="line">  &lt;typeHandler handler=&quot;org.mybatis.example.ExampleTypeHandler&quot;/&gt;</span><br><span class="line">&lt;/typeHandlers&gt;</span><br></pre></td></tr></table></figure>
<p><strong>使用这个的类型处理器将会覆盖已经存在的处理 Java 的 String 类型属性和 VARCHAR 参数及结果的类型处理器</strong>。 要注意 MyBatis 不会窥探数据库元信息来决定使用哪种类型，所以你必须在参数和结果映射中指明那是 VARCHAR 类型的字段， 以使其能够绑定到正确的类型处理器上。 这是因为：<strong>MyBatis 直到语句被执行才清楚数据类型</strong>。 </p>
<p>通过类型处理器的泛型，MyBatis 可以得知该类型处理器处理的 <strong>Java 类型</strong>，不过这种行为可以通过两种方法改变： </p>
<p>1.在类型处理器的配置元素（typeHandler element）上增加一个 javaType 属性（比如：<strong>javaType=”String”</strong>）；<br>2.在类型处理器的类上（TypeHandler class）增加一个 <strong>@MappedTypes</strong> 注解来指定与其关联的 Java 类型列表。 如果在 javaType 属性中也同时指定，则注解方式将被忽略。</p>
<p>这两种方法应该等价吧。</p>
<p>可以通过两种方式来指定被关联的 <strong>JDBC 类型</strong>：</p>
<p>1.在类型处理器的配置元素上增加一个 jdbcType 属性（比如：<strong>jdbcType=”VARCHAR”</strong>）；<br>2.在类型处理器的类上（TypeHandler class）增加一个 <strong>@MappedJdbcTypes</strong> 注解来指定与其关联的 JDBC 类型列表。 如果在 jdbcType 属性中也同时指定，则注解方式将被忽略。</p>
<p>这两种方法也应该等价吧。</p>
<p>上述两种类型（java类型，JDBC类型）非常重要。当决定在ResultMap中使用某一TypeHandler时，此时java类型是已知的（从结果类型中获得），但是JDBC类型是未知的。<strong>Mybatis使用javaType=[TheJavaType], jdbcType=null的组合来选择一个TypeHandler</strong>。</p>
<p>配置以查找类型处理器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- mybatis-config.xml --&gt;</span><br><span class="line">&lt;typeHandlers&gt;</span><br><span class="line">  &lt;package name=&quot;org.mybatis.example&quot;/&gt;</span><br><span class="line">&lt;/typeHandlers&gt;</span><br></pre></td></tr></table></figure>
<p>注意在使用自动检索（autodiscovery）功能的时候，只能通过注解方式来指定 JDBC 的类型。</p>
<p><em>5.对象工厂（objectFactory）</em></p>
<p><strong>MyBatis 每次创建结果对象的新实例时，它都会使用一个对象工厂（ObjectFactory）实例来完成</strong>。 默认的对象工厂需要做的仅仅是实例化目标类，要么通过默认构造方法，要么在参数映射存在的时候通过参数构造方法来实例化。 如果想覆盖对象工厂的默认行为，则可以通过创建自己的对象工厂来实现。</p>
<p><em>6.插件（plugins）</em></p>
<p><strong>MyBatis 允许你在已映射语句执行过程中的某一点进行拦截调用</strong>。默认情况下，MyBatis 允许使用插件来拦截的方法调用包括： </p>
<p>1.Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)<br>2.ParameterHandler (getParameterObject, setParameters)<br>3.ResultSetHandler (handleResultSets, handleOutputParameters)<br>4.StatementHandler (prepare, parameterize, batch, update, query)</p>
<p>通过 MyBatis 提供的强大机制，使用插件是非常简单的，<strong>只需实现 Interceptor 接口，并指定了想要拦截的方法签名即可</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// ExamplePlugin.java</span><br><span class="line">@Intercepts(&#123;@Signature(</span><br><span class="line">  type= Executor.class,</span><br><span class="line">  method = &quot;update&quot;,</span><br><span class="line">  args = &#123;MappedStatement.class,Object.class&#125;)&#125;)</span><br><span class="line">public class ExamplePlugin implements Interceptor &#123;</span><br><span class="line">  public Object intercept(Invocation invocation) throws Throwable &#123;</span><br><span class="line">    return invocation.proceed();</span><br><span class="line">  &#125;</span><br><span class="line">  public Object plugin(Object target) &#123;</span><br><span class="line">    return Plugin.wrap(target, this);</span><br><span class="line">  &#125;</span><br><span class="line">  public void setProperties(Properties properties) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- mybatis-config.xml --&gt;</span><br><span class="line">&lt;plugins&gt;</span><br><span class="line">  &lt;plugin interceptor=&quot;org.mybatis.example.ExamplePlugin&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;someProperty&quot; value=&quot;100&quot;/&gt;</span><br><span class="line">  &lt;/plugin&gt;</span><br><span class="line">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure>
<p><strong>上面的插件将会拦截在 Executor 实例中所有的 “update” 方法调用， 这里的 Executor 是负责执行低层映射语句的内部对象</strong>。</p>
<p><em>7.配置环境（environments）</em></p>
<p>MyBatis 可以配置成适应多种环境，这种机制有助于将 SQL 映射应用于多种数据库之中， 现实情况下有多种理由需要这么做。例如，开发、测试和生产环境需要有不同的配置；或者共享相同 Schema 的多个生产数据库， 想使用相同的 SQL 映射。</p>
<p><strong>不过要记住：尽管可以配置多个环境，每个 SqlSessionFactory 实例只能选择其一</strong>。</p>
<p>必须遵守的原则：<strong>每个数据库对应一个 SqlSessionFactory 实例</strong>。</p>
<p>环境元素定义了如何配置环境。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">  &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">    &lt;transactionManager type=&quot;JDBC&quot;&gt;</span><br><span class="line">      &lt;property name=&quot;...&quot; value=&quot;...&quot;/&gt;</span><br><span class="line">    &lt;/transactionManager&gt;</span><br><span class="line">    &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">      &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</span><br><span class="line">      &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</span><br><span class="line">      &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</span><br><span class="line">      &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</span><br><span class="line">    &lt;/dataSource&gt;</span><br><span class="line">  &lt;/environment&gt;</span><br><span class="line">&lt;/environments&gt;</span><br></pre></td></tr></table></figure>
<p> 注意这里的关键点:<br>1.默认的环境 ID（比如:default=”development”）。<br>2.每个 environment 元素定义的环境 ID（比如:id=”development”）。<br>3.事务管理器的配置（比如:type=”JDBC”）。<br>4.数据源的配置（比如:type=”POOLED”）。</p>
<p><strong>事务管理器</strong><br>在 MyBatis 中有两种类型的事务管理器（也就是 <strong>type=[JDBC|MANAGED]</strong>”），<strong>如果你正在使用 Spring + MyBatis，则没有必要配置事务管理器</strong>， 因为 Spring 模块会使用自带的管理器来覆盖前面的配置。 </p>
<p><strong>数据源</strong><br>有三种内建的数据源类型（也就是 <strong>type=”[UNPOOLED|POOLED|JNDI]”</strong>）</p>
<p><strong>UNPOOLED</strong>– <strong>这个数据源的实现只是每次被请求时打开和关闭连接</strong>。虽然一点慢，它对在及时可用连接方面没有性能要求的简单应用程序是一个很好的选择。 不同的数据库在这方面表现也是不一样的，所以对某些数据库来说使用连接池并不重要，这个配置也是理想的。</p>
<p><strong>POOLED</strong>– <strong>这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这是一种使得并发 Web 应用快速响应请求的流行处理方式</strong>。 </p>
<p><strong>JNDI</strong>– 这个数据源的实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个 JNDI 上下文的引用。</p>
<p><em>8.databaseIdProvider</em></p>
<p><strong>MyBatis 可以根据不同的数据库厂商执行不同的语句，这种多厂商的支持是基于映射语句中的 databaseId 属性</strong>。 MyBatis 会加载不带 databaseId 属性和带有匹配当前数据库 databaseId 属性的所有语句。 如果同时找到带有 databaseId 和不带 databaseId 的相同语句，则后者会被舍弃。 为支持多厂商特性只要像下面这样在 mybatis-config.xml 文件中加入 databaseIdProvider 即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;databaseIdProvider type=&quot;DB_VENDOR&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p><em>9.映射器（mappers）</em></p>
<p>既然 MyBatis 的行为已经由上述元素配置完了，我们现在就要定义 SQL 映射语句了。但是<strong>首先我们需要告诉 MyBatis 到哪里去找到这些语句</strong>。 <strong>Java 在自动查找这方面没有提供一个很好的方法，所以最佳的方式是告诉 MyBatis 到哪里去找映射文件（iBatis没有像Spring那样在自动查找方面的造诣啊）</strong>。你可以使用相对于类路径的资源引用， 或完全限定资源定位符（包括 file:/// 的 URL），或类名和包名等。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Using classpath relative resources --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper resource=&quot;org/mybatis/builder/AuthorMapper.xml&quot;/&gt;</span><br><span class="line">  &lt;mapper resource=&quot;org/mybatis/builder/BlogMapper.xml&quot;/&gt;</span><br><span class="line">  &lt;mapper resource=&quot;org/mybatis/builder/PostMapper.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Using mapper interface classes --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper class=&quot;org.mybatis.builder.AuthorMapper&quot;/&gt;</span><br><span class="line">  &lt;mapper class=&quot;org.mybatis.builder.BlogMapper&quot;/&gt;</span><br><span class="line">  &lt;mapper class=&quot;org.mybatis.builder.PostMapper&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Register all interfaces in a package as mappers --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;package name=&quot;org.mybatis.builder&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure>
<p>感觉方式三用的应该比较多。</p>
<h2 id="Mapper-XML-文件"><a href="#Mapper-XML-文件" class="headerlink" title="Mapper XML 文件"></a>Mapper XML 文件</h2><p>MyBatis 的真正强大在于它的<strong>映射语句</strong>。</p>
<p>SQL 映射文件有很少的几个顶级元素（按照它们应该被定义的顺序）：</p>
<p>1.cache – 给定命名空间的缓存配置。<br>2.cache-ref – 其他命名空间缓存配置的引用。<br>3.resultMap – 是最复杂也是最强大的元素，用来描述如何从数据库结果集中来加载对象。<br>4.sql – 可被其他语句引用的可重用语句块。<br>5.insert – 映射插入语句<br>6.update – 映射更新语句<br>7.delete – 映射删除语句<br>8.select – 映射查询语句</p>
<p><em>1.select</em></p>
<p><strong>查询操作相对是比较频繁的</strong>。对每个插入、更新或删除操作，通常对应多个查询操作。这是 MyBatis 的基本原则之一，也是将焦点和努力放到<strong>1.查询</strong>和<strong>2.结果映射</strong>的原因。简单查询的 select 元素是非常简单的。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectPerson&quot; parameterType=&quot;int&quot; resultType=&quot;hashmap&quot;&gt;</span><br><span class="line">  SELECT * FROM PERSON WHERE ID = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>select 元素有很多属性允许你配置，来决定每条语句的作用细节。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;select</span><br><span class="line">  id=&quot;selectPerson&quot;</span><br><span class="line">  parameterType=&quot;int&quot;</span><br><span class="line">  parameterMap=&quot;deprecated&quot;</span><br><span class="line">  resultType=&quot;hashmap&quot;</span><br><span class="line">  resultMap=&quot;personResultMap&quot;</span><br><span class="line">  flushCache=&quot;false&quot;</span><br><span class="line">  useCache=&quot;true&quot;</span><br><span class="line">  timeout=&quot;10000&quot;</span><br><span class="line">  fetchSize=&quot;256&quot;</span><br><span class="line">  statementType=&quot;PREPARED&quot;</span><br><span class="line">  resultSetType=&quot;FORWARD_ONLY&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>关于这些属性的配置意义，参考<a href="http://www.mybatis.org/mybatis-3/zh/sqlmap-xml.html" target="_blank" rel="external">Mapper XML 文件</a></p>
<p>几个重要参数：</p>
<p><strong>id</strong>–在命名空间中唯一的标识符，可以被用来引用这条语句。<br><strong>parameterType</strong>–将会传入这条语句的参数类的完全限定名或别名。<strong>这个属性是可选的</strong>，因为 MyBatis 可以通过 TypeHandler 推断出具体传入语句的参数，默认值为 unset。<br><strong>resultType</strong>–从这条语句中返回的期望类型的类的完全限定名或别名。注意如果是集合情形，那应该是集合可以包含的类型，而不能是集合本身。使用 resultType 或 resultMap，但不能同时使用。</p>
<p><em>2.insert, update 和 delete</em></p>
<p>跟insert语句差不多，有些属性增删，需要时查即可。</p>
<p>一个完整的示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=&quot;insertAuthor&quot;&gt;</span><br><span class="line">  insert into Author (id,username,password,email,bio)</span><br><span class="line">  values (#&#123;id&#125;,#&#123;username&#125;,#&#123;password&#125;,#&#123;email&#125;,#&#123;bio&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">&lt;update id=&quot;updateAuthor&quot;&gt;</span><br><span class="line">  update Author set</span><br><span class="line">    username = #&#123;username&#125;,</span><br><span class="line">    password = #&#123;password&#125;,</span><br><span class="line">    email = #&#123;email&#125;,</span><br><span class="line">    bio = #&#123;bio&#125;</span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br><span class="line"></span><br><span class="line">&lt;delete id=&quot;deleteAuthor&quot;&gt;</span><br><span class="line">  delete from Author where id = #&#123;id&#125;</span><br><span class="line">&lt;/delete&gt;</span><br></pre></td></tr></table></figure>
<p>重点来看<strong>insert操作</strong>！</p>
<p><strong>对于插入语句的配置规则更加丰富</strong>，在插入语句里面有一些额外的属性和子元素用来处理<strong>1.主键的生成</strong>，而且有多种生成方式。</p>
<p>如果你的数据库支持自动生成主键的字段（比如 MySQL 和 SQL Server），那么你可以设置 <strong>useGeneratedKeys=”true”</strong>，然后再把 keyProperty 设置到目标属性上就OK了。例如，如果上面的 Author 表已经对 id 使用了自动生成的列类型，那么语句可以修改为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=&quot;insertAuthor&quot; useGeneratedKeys=&quot;true&quot;</span><br><span class="line">    keyProperty=&quot;id&quot;&gt;</span><br><span class="line">  insert into Author (username,password,email,bio)</span><br><span class="line">  values (#&#123;username&#125;,#&#123;password&#125;,#&#123;email&#125;,#&#123;bio&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>
<p>这样就省掉了传值的时候还要传递增的id值（有时候这个值是比较麻烦的）。</p>
<p>如果你的数据库还支持<strong>2.多行插入</strong>, 你也可以传入一个Authors数组或集合，并返回自动生成的主键。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=&quot;insertAuthor&quot; useGeneratedKeys=&quot;true&quot;</span><br><span class="line">    keyProperty=&quot;id&quot;&gt;</span><br><span class="line">  insert into Author (username, password, email, bio) values</span><br><span class="line">  &lt;foreach item=&quot;item&quot; collection=&quot;list&quot; separator=&quot;,&quot;&gt;</span><br><span class="line">    (#&#123;item.username&#125;, #&#123;item.password&#125;, #&#123;item.email&#125;, #&#123;item.bio&#125;)</span><br><span class="line">  &lt;/foreach&gt;</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>
<p><em>3.sql</em></p>
<p>这个元素可以被<strong>用来定义可重用的 SQL 代码段</strong>，可以包含在其他语句中。它可以被静态地(在加载参数) 参数化. 不同的属性值通过包含的实例变化. 比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;sql id=&quot;userColumns&quot;&gt; $&#123;alias&#125;.id,$&#123;alias&#125;.username,$&#123;alias&#125;.password &lt;/sql&gt;</span><br></pre></td></tr></table></figure>
<p>这个可重用的语句可以被这样引用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectUsers&quot; resultType=&quot;map&quot;&gt;</span><br><span class="line">  select</span><br><span class="line">    &lt;include refid=&quot;userColumns&quot;&gt;&lt;property name=&quot;alias&quot; value=&quot;t1&quot;/&gt;&lt;/include&gt;,</span><br><span class="line">    &lt;include refid=&quot;userColumns&quot;&gt;&lt;property name=&quot;alias&quot; value=&quot;t2&quot;/&gt;&lt;/include&gt;</span><br><span class="line">  from some_table t1</span><br><span class="line">    cross join some_table t2</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>通过refid来引用，通过name，value来对可重用的sql语句赋值。</p>
<p><strong>属性值可以用于包含的refid属性或者包含的字句里面的属性值</strong>，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;sql id=&quot;sometable&quot;&gt;</span><br><span class="line">  $&#123;prefix&#125;Table</span><br><span class="line">&lt;/sql&gt;</span><br><span class="line"></span><br><span class="line">&lt;sql id=&quot;someinclude&quot;&gt;</span><br><span class="line">  from</span><br><span class="line">    &lt;include refid=&quot;$&#123;include_target&#125;&quot;/&gt;</span><br><span class="line">&lt;/sql&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;select&quot; resultType=&quot;map&quot;&gt;</span><br><span class="line">  select</span><br><span class="line">    field1, field2, field3</span><br><span class="line">  &lt;include refid=&quot;someinclude&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;prefix&quot; value=&quot;Some&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;include_target&quot; value=&quot;sometable&quot;/&gt;</span><br><span class="line">  &lt;/include&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>该示例中最上层select向下两层进行了赋值。</p>
<p><em>4.参数（Parameters）</em></p>
<p><em>5.Result Maps</em></p>
<p><strong>resultMap 元素是 MyBatis 中最重要最强大的元素</strong>。</p>
<p>在前面的示例中，一些简单映射语句的示例,没有明确的 resultMap。比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectUsers&quot; resultType=&quot;map&quot;&gt;</span><br><span class="line">  select id, username, hashedPassword</span><br><span class="line">  from some_table</span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>这样一个语句简单作用于所有列被<strong>自动映射到 HashMap 的键上,这由 resultType 属性 指定</strong>。这在很多情况下是有用的,但是 HashMap 不能很好描述一个领域模型。那样你的应 用程序将会使用 <strong>1.JavaBeans</strong> 或 <strong>2.POJOs(Plain Old Java Objects</strong>,普通 Java 对象)来作为领域 模型。MyBatis 对两者都支持。看看下面这个 JavaBean:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.someapp.model;</span><br><span class="line">public class User &#123;</span><br><span class="line">  private int id;</span><br><span class="line">  private String username;</span><br><span class="line">  private String hashedPassword;</span><br><span class="line">  </span><br><span class="line">  public int getId() &#123;</span><br><span class="line">    return id;</span><br><span class="line">  &#125;</span><br><span class="line">  public void setId(int id) &#123;</span><br><span class="line">    this.id = id;</span><br><span class="line">  &#125;</span><br><span class="line">  public String getUsername() &#123;</span><br><span class="line">    return username;</span><br><span class="line">  &#125;</span><br><span class="line">  public void setUsername(String username) &#123;</span><br><span class="line">    this.username = username;</span><br><span class="line">  &#125;</span><br><span class="line">  public String getHashedPassword() &#123;</span><br><span class="line">    return hashedPassword;</span><br><span class="line">  &#125;</span><br><span class="line">  public void setHashedPassword(String hashedPassword) &#123;</span><br><span class="line">    this.hashedPassword = hashedPassword;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基于 JavaBean 的规范,上面这个类有 3 个属性:id,username 和 hashedPassword。这些 在 select 语句中会精确匹配到列名。</p>
<p>这样的一个 JavaBean 可以被映射到结果集,就像映射到 HashMap 一样简单。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- In mybatis-config.xml file --&gt;</span><br><span class="line">&lt;typeAlias type=&quot;com.someapp.model.User&quot; alias=&quot;User&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- In SQL Mapping XML file --&gt;</span><br><span class="line">&lt;select id=&quot;selectUsers&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">  select id, username, hashedPassword</span><br><span class="line">  from some_table</span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p><strong>如果列名没有精确匹配</strong>,你可以在列名上使用 select 字句的别名(一个 基本的 SQL 特性)来匹配标签。比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectUsers&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">  select</span><br><span class="line">    user_id             as &quot;id&quot;,</span><br><span class="line">    user_name           as &quot;userName&quot;,</span><br><span class="line">    hashed_password     as &quot;hashedPassword&quot;</span><br><span class="line">  from some_table</span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>以上都是简单的映射。下面来看看<strong>高级结果映射</strong>：</p>
<p>高级结果映射还是比较有难度的，需要时再看看。</p>
<p><em>6.自动映射</em></p>
<p>正如你在前面一节看到的，在简单的场景下，MyBatis可以替你自动映射查询结果。 如果遇到复杂的场景，你需要构建一个result map。 但是在本节你将看到，你也可以混合使用这两种策略。 让我们到深一点的层面上看看自动映射是怎样工作的。</p>
<p><strong>当自动映射查询结果时，MyBatis会获取sql返回的列名并在java类中查找相同名字的属性（忽略大小写）。 这意味着如果Mybatis发现了ID列和id属性，Mybatis会将ID的值赋给id</strong>。</p>
<p><strong>通常数据库列使用大写单词命名，单词间用下划线分隔；而java属性一般遵循驼峰命名法。 为了在这两种命名方式之间启用自动映射，需要将 mapUnderscoreToCamelCase设置为true</strong>。</p>
<p>自动映射甚至在特定的result map下也能工作。在这种情况下，对于每一个result map,所有的ResultSet提供的列， 如果没有被手工映射，则将被自动映射。<strong>自动映射处理完毕后手工映射才会被处理</strong>。 在接下来的例子中， id 和 userName列将被自动映射， hashed_password 列将根据配置映射。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectUsers&quot; resultMap=&quot;userResultMap&quot;&gt;</span><br><span class="line">  select</span><br><span class="line">    user_id             as &quot;id&quot;,</span><br><span class="line">    user_name           as &quot;userName&quot;,</span><br><span class="line">    hashed_password</span><br><span class="line">  from some_table</span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=&quot;userResultMap&quot; type=&quot;User&quot;&gt;</span><br><span class="line">  &lt;result property=&quot;password&quot; column=&quot;hashed_password&quot;/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure>
<p>有三种自动映射等级：</p>
<p>1.<strong>NONE</strong> - 禁用自动映射。仅设置手动映射属性。<br>2.<strong>PARTIAL</strong> - 将自动映射结果除了那些有内部定义内嵌结果映射的(joins).<br>3.<strong>FULL</strong> - 自动映射所有。</p>
<p>默认值是<strong>PARTIAL</strong></p>
<p><em>7.缓存</em></p>
<h2 id="动态-SQL"><a href="#动态-SQL" class="headerlink" title="动态 SQL"></a>动态 SQL</h2><p><em>1.if</em></p>
<p><strong>动态 SQL 通常要做的事情是有条件地包含 where 子句的一部分</strong>。比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;findActiveBlogWithTitleLike&quot;</span><br><span class="line">     resultType=&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG </span><br><span class="line">  WHERE state = ‘ACTIVE’ </span><br><span class="line">  &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>这条语句提供了一个可选的文本查找类型的功能。如果没有传入“title”，那么所有处于“ACTIVE”状态的BLOG都会返回；反之若传入了“title”，那么就会把模糊查找“title”内容的BLOG结果返回（就这个例子而言，<strong>细心的读者会发现其中的参数值是可以包含一些掩码或通配符的</strong>）。</p>
<p>如果想可选地通过“title”和“author”两个条件搜索该怎么办呢？首先，改变语句的名称让它更具实际意义；然后只要加入另一个条件即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;findActiveBlogLike&quot;</span><br><span class="line">     resultType=&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG WHERE state = ‘ACTIVE’ </span><br><span class="line">  &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">  &lt;if test=&quot;author != null and author.name != null&quot;&gt;</span><br><span class="line">    AND author_name like #&#123;author.name&#125;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p><em>2.choose, when, otherwise</em></p>
<p>有些时候，我们不想用到所有的条件语句，而只想从中择其一二。针对这种情况，<strong>MyBatis 提供了 choose 元素，它有点像 Java 中的 switch 语句</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;findActiveBlogLike&quot;</span><br><span class="line">     resultType=&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG WHERE state = ‘ACTIVE’</span><br><span class="line">  &lt;choose&gt;</span><br><span class="line">    &lt;when test=&quot;title != null&quot;&gt;</span><br><span class="line">      AND title like #&#123;title&#125;</span><br><span class="line">    &lt;/when&gt;</span><br><span class="line">    &lt;when test=&quot;author != null and author.name != null&quot;&gt;</span><br><span class="line">      AND author_name like #&#123;author.name&#125;</span><br><span class="line">    &lt;/when&gt;</span><br><span class="line">    &lt;otherwise&gt;</span><br><span class="line">      AND featured = 1</span><br><span class="line">    &lt;/otherwise&gt;</span><br><span class="line">  &lt;/choose&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p><em>3.trim, where, set</em></p>
<p>现在考虑回到“if”示例，这次我们将“ACTIVE = 1”也设置成动态的条件，看看会发生什么。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;findActiveBlogLike&quot;</span><br><span class="line">     resultType=&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG </span><br><span class="line">  WHERE </span><br><span class="line">  &lt;if test=&quot;state != null&quot;&gt;</span><br><span class="line">    state = #&#123;state&#125;</span><br><span class="line">  &lt;/if&gt; </span><br><span class="line">  &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">  &lt;if test=&quot;author != null and author.name != null&quot;&gt;</span><br><span class="line">    AND author_name like #&#123;author.name&#125;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>如果所有条件都没有匹配，那么sql语句变成了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM BLOG</span><br><span class="line">WHERE</span><br></pre></td></tr></table></figure>
<p>同样仅匹配了第二条，会变成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM BLOG</span><br><span class="line">WHERE </span><br><span class="line">AND title like ‘someTitle’</span><br></pre></td></tr></table></figure>
<p>上述两种情况的查询都会失败。那么怎么办呢？上述失败可以使用<strong>where元素</strong>来避免。</p>
<p>where 元素知道只有在一个以上的if条件有值的情况下才去插入“WHERE”子句。而且，若最后的内容是“AND”或“OR”开头的，where 元素也知道如何将他们去除。<strong>改写成where元素形式（并不显示地前置where字符串）</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;findActiveBlogLike&quot;</span><br><span class="line">     resultType=&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG </span><br><span class="line">  &lt;where&gt; </span><br><span class="line">    &lt;if test=&quot;state != null&quot;&gt;</span><br><span class="line">         state = #&#123;state&#125;</span><br><span class="line">    &lt;/if&gt; </span><br><span class="line">    &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">        AND title like #&#123;title&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;author != null and author.name != null&quot;&gt;</span><br><span class="line">        AND author_name like #&#123;author.name&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：在用<code>&lt;where&gt;</code>时，千万要加<code>SELECT * FROM BLOG</code>啊！我就在这个小问题上犯错了！还要加上<code>AND</code>或者<code>OR</code>啊！</p>
<p>如果 where 元素没有按正常套路出牌，我们还是<strong>可以通过自定义 trim 元素来定制我们想要的功能</strong>。比如，<strong>和 where 元素等价的自定义 trim 元素为</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;trim prefix=&quot;WHERE&quot; prefixOverrides=&quot;AND |OR &quot;&gt;</span><br><span class="line">  ... </span><br><span class="line">&lt;/trim&gt;</span><br></pre></td></tr></table></figure>
<p>prefixOverrides 属性会忽略通过管道分隔的文本序列（<strong>注意此例中的空格也是必要的</strong>）。</p>
<p>类似的<strong>用于动态更新语句的解决方案叫做 set</strong>。set 元素可以被用于动态包含需要更新的列，而舍去其他的。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=&quot;updateAuthorIfNecessary&quot;&gt;</span><br><span class="line">  update Author</span><br><span class="line">    &lt;set&gt;</span><br><span class="line">      &lt;if test=&quot;username != null&quot;&gt;username=#&#123;username&#125;,&lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;password != null&quot;&gt;password=#&#123;password&#125;,&lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;email != null&quot;&gt;email=#&#123;email&#125;,&lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;bio != null&quot;&gt;bio=#&#123;bio&#125;&lt;/if&gt;</span><br><span class="line">    &lt;/set&gt;</span><br><span class="line">  where id=#&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>
<p>这里，set 元素会动态前置 SET 关键字，同时也会消除无关的逗号，因为用了条件语句之后很可能就会在生成的赋值语句的后面留下这些逗号。</p>
<p>若你对<strong>等价的自定义 trim 元素</strong>的样子感兴趣，那这就应该是它的真面目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;trim prefix=&quot;SET&quot; suffixOverrides=&quot;,&quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/trim&gt;</span><br></pre></td></tr></table></figure></p>
<p><em>4.foreach</em></p>
<p><strong>动态 SQL 的另外一个常用的必要操作是需要对一个集合进行遍历，通常是在构建 IN 条件语句的时候</strong>。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectPostIn&quot; resultType=&quot;domain.blog.Post&quot;&gt;</span><br><span class="line">  SELECT *</span><br><span class="line">  FROM POST P</span><br><span class="line">  WHERE ID in</span><br><span class="line">  &lt;foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;list&quot;</span><br><span class="line">      open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;</span><br><span class="line">        #&#123;item&#125;</span><br><span class="line">  &lt;/foreach&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p><strong>可以将任何可迭代对象（如列表、集合等）和任何的字典或者数组对象传递给foreach作为集合参数</strong>。<strong>当使用可迭代对象或者数组时，index是当前迭代的次数，item的值是本次迭代获取的元素</strong>。<strong>当使用字典（或者Map.Entry对象的集合）时，index是键，item是值</strong>。</p>
<p><em>5.bind</em></p>
<p>bind 元素可以从 OGNL 表达式中<strong>创建一个变量并将其绑定到上下文</strong>。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectBlogsLike&quot; resultType=&quot;Blog&quot;&gt;</span><br><span class="line">  &lt;bind name=&quot;pattern&quot; value=&quot;&apos;%&apos; + _parameter.getTitle() + &apos;%&apos;&quot; /&gt;</span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  WHERE title LIKE #&#123;pattern&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Java-API"><a href="#Java-API" class="headerlink" title="Java API"></a>Java API</h2><p>既然你已经知道<strong>1.如何配置 MyBatis</strong> 和<strong>2.创建映射文件</strong>,你就已经准备好来提升技能了。 <strong>MyBatis 的 Java API 就是你收获你所做的努力的地方</strong>。哈哈哈，出结果的地方终于要来了。</p>
<p>推荐使用的<a href="http://www.mybatis.org/mybatis-3/zh/java-api.html" target="_blank" rel="external">目录结构</a></p>
<p><em>1.SqlSessions</em></p>
<p>在前面的内容中，我们学习到，创建SqlSessions的一般步骤是：SqlSessionFactoryBuilder-&gt;SqlSessionFactory-&gt;SqlSession。</p>
<p><strong>简化操作</strong>：<br>当Mybatis与一些依赖注入框架（如Spring或者Guice）同时使用时，<strong>SqlSessions将被依赖注入框架所创建，所以你不需要使用SqlSessionFactoryBuilder或者SqlSessionFactory</strong>，可以直接看SqlSession这一节。请参考Mybatis-Spring或者Mybatis-Guice手册了解更多信息。 </p>
<p><strong>SqlSession</strong></p>
<p>直接看这里</p>
<p> 如上面所提到的,SqlSession 实例在 MyBatis 中是非常强大的一个类。在这里你会发现 所有执行语句的方法,提交或回滚事务,还有获取映射器实例。</p>
<p>在 SqlSession 类中有超过 20 个方法,所以将它们分开成易于理解的组合。 </p>
<p><strong>1.语句执行方法</strong></p>
<p>这些方法被<strong>用来执行定义在 SQL 映射的 XML 文件中的 SELECT,INSERT,UPDA E T 和 DELETE 语句</strong>。它们都会自行解释,每一句都使用语句的 <strong>ID 属性</strong>和<strong>参数对象</strong>,参数可以 是原生类型(自动装箱或包装类) ,JavaBean,POJO 或 Map。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; T selectOne(String statement, Object parameter)</span><br><span class="line">&lt;E&gt; List&lt;E&gt; selectList(String statement, Object parameter)</span><br><span class="line">&lt;K,V&gt; Map&lt;K,V&gt; selectMap(String statement, Object parameter, String mapKey)</span><br><span class="line">int insert(String statement, Object parameter)</span><br><span class="line">int update(String statement, Object parameter)</span><br><span class="line">int delete(String statement, Object parameter)</span><br></pre></td></tr></table></figure>
<p>selectOne 和 selectList 的不同仅仅是 selectOne 必须返回一个对象。 如果多余一个, 或者 没有返回 (或返回了 null) 那么就会抛出异常。 , <strong>如果你不知道需要多少对象, 使用 selectList</strong>。 </p>
<p><strong>如果你想检查一个对象是否存在,那么最好返回统计数(0 或 1)</strong> 。因为并不是所有语句都需 要参数,这些方法都是有不同重载版本的,它们可以不需要参数对象。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; T selectOne(String statement)</span><br><span class="line">&lt;E&gt; List&lt;E&gt; selectList(String statement)</span><br><span class="line">&lt;K,V&gt; Map&lt;K,V&gt; selectMap(String statement, String mapKey)</span><br><span class="line">int insert(String statement)</span><br><span class="line">int update(String statement)</span><br><span class="line">int delete(String statement)</span><br></pre></td></tr></table></figure>
<p>最后,还有<strong>查询方法的三个高级版本</strong>,它们<strong>允许你限制返回行数的范围</strong>,或者<strong>提供自定 义结果控制逻辑</strong>,这通常用于大量的数据集合。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;E&gt; List&lt;E&gt; selectList (String statement, Object parameter, RowBounds rowBounds)</span><br><span class="line">&lt;K,V&gt; Map&lt;K,V&gt; selectMap(String statement, Object parameter, String mapKey, RowBounds rowbounds)</span><br><span class="line">void select (String statement, Object parameter, ResultHandler&lt;T&gt; handler)</span><br><span class="line">void select (String statement, Object parameter, RowBounds rowBounds, ResultHandler&lt;T&gt; handler)</span><br></pre></td></tr></table></figure>
<p><strong>RowBounds</strong> 参数会告诉 MyBatis 略过指定数量的记录,还有限制返回结果的数量。 RowBounds 类有一个构造方法来接收 offset 和 limit,否则是不可改变的。 这个功能在网站返回分页结果的地方正好有用！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int offset = 100;</span><br><span class="line">int limit = 25;</span><br><span class="line">RowBounds rowBounds = new RowBounds(offset, limit);</span><br></pre></td></tr></table></figure>
<p>不同的驱动会实现这方面的不同级别的效率。对于最佳的表现,<strong>使用结果集类型的 SCROLL_SENSITIVE 或 SCROLL_INSENSITIVE(换句话说:不是 FORWARD_ONLY)</strong>。 </p>
<p><strong>ResultHandler 参数允许你按你喜欢的方式处理每一行</strong>。<strong>你可以将它添加到 List 中,创 建 Map, 或抛出每个结果而不是只保留总计</strong>。 Set 你可以使用 ResultHandler 做很多漂亮的事, 那就是 MyBatis 内部创建结果集列表。</p>
<p>它的接口很简单。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">package org.apache.ibatis.session;</span><br><span class="line">public interface ResultHandler&lt;T&gt; &#123;</span><br><span class="line">  void handleResult(ResultContext&lt;? extends T&gt; context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ResultContext 参数给你访问结果对象本身的方法</strong>, 大量结果对象被创建, 你可以使用布尔返回值的 stop()方法来停止 MyBatis 加载更多的结果。 </p>
<p>实现这个接口看来很有用且很方便。</p>
<p><strong>2.批量立即更新方法(Flush Method)</strong></p>
<p>有一个方法可以<strong>刷新（执行）存储在JDBC驱动类中的批量更新语句</strong>。当你将ExecutorType.BATCH作为ExecutorType使用时可以采用此方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;BatchResult&gt; flushStatements()</span><br></pre></td></tr></table></figure>
<p><strong>3.事务控制方法</strong></p>
<p>控制事务作用域有四个方法。 当然, <strong>如果你已经选择了自动提交或你正在使用外部事务管理器,这就没有任何效果了</strong>。也就是说，前提是没有使用自动提交或者外部事务处理器。如果你正在使用 <strong>JDBC 事务管理员</strong>,由 <strong>Connection 实 例</strong>来控制,那么这四个方法就会派上用场: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">void commit()</span><br><span class="line">void commit(boolean force)</span><br><span class="line">void rollback()</span><br><span class="line">void rollback(boolean force)</span><br></pre></td></tr></table></figure>
<p>MyBatis-Spring和MyBatis-Guice提供了<strong>声明事务处理</strong>，所以如果你在使用Mybatis的同时使用了Spring或者Guice，那么请参考它们的手册以获取更多的内容。</p>
<p><strong>4.清理 Session 级的缓存</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void clearCache()</span><br></pre></td></tr></table></figure>
<p><strong>SqlSession 实例有一个本地缓存在执行 update,commit,rollback 和 close 时被清理</strong>。要 明确地关闭它(获取打算做更多的工作) ,你可以调用 clearCache()。 </p>
<p><strong>5.确保 SqlSession 被关闭</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void close()</span><br></pre></td></tr></table></figure>
<p>你必须保证的最重要的事情是<strong>你要关闭所打开的任何 session</strong>。保证做到这点的最佳方 式是下面的工作模式: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">try &#123;</span><br><span class="line">    // following 3 lines pseudocod for &quot;doing some work&quot;</span><br><span class="line">    session.insert(...);</span><br><span class="line">    session.update(...);</span><br><span class="line">    session.delete(...);</span><br><span class="line">    session.commit();</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以通过调用 <strong>getConfiguration()方法</strong>获得 SqlSession 使用的 Configuration 实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Configuration getConfiguration()</span><br></pre></td></tr></table></figure>
<p>以上这些方法的调用主体都是SqlSession哦，不要忘记了。</p>
<p><strong>6.使用映射器</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; T getMapper(Class&lt;T&gt; type)</span><br></pre></td></tr></table></figure>
<p>上述的各个 insert,update,delete 和 select 方法都很强大,但也有些繁琐,没有类型安全。</p>
<p>因此, <strong>一个更通用的方式来执行映射语句是使用映射器类</strong>。 一个映射器类就是一个简单 的接口,其中的方法定义匹配于 SqlSession 方法。下面的示例展示了一些方法签名和它们是 如何映射到 SqlSession 的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public interface AuthorMapper &#123;</span><br><span class="line">  // (Author) selectOne(&quot;selectAuthor&quot;,5);</span><br><span class="line">  Author selectAuthor(int id); </span><br><span class="line">  // (List&lt;Author&gt;) selectList(“selectAuthors”)</span><br><span class="line">  List&lt;Author&gt; selectAuthors();</span><br><span class="line">  // (Map&lt;Integer,Author&gt;) selectMap(&quot;selectAuthors&quot;, &quot;id&quot;)</span><br><span class="line">  @MapKey(&quot;id&quot;)</span><br><span class="line">  Map&lt;Integer, Author&gt; selectAuthors();</span><br><span class="line">  // insert(&quot;insertAuthor&quot;, author)</span><br><span class="line">  int insertAuthor(Author author);</span><br><span class="line">  // updateAuthor(&quot;updateAuthor&quot;, author)</span><br><span class="line">  int updateAuthor(Author author);</span><br><span class="line">  // delete(&quot;deleteAuthor&quot;,5)</span><br><span class="line">  int deleteAuthor(int id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总之, 每个映射器方法签名应该匹配相关联的 SqlSession 方法, 而没有字符串参数 ID。 相反,<strong>方法名必须匹配映射语句的 ID</strong>。 这一点非常重要啊！不然，光有调用方式和接口定义，怎么框架怎么知道具体的sql语句呢？</p>
<p>映射器接口不需要去实现任何接口或扩展任何类。 只要方法前面可以被用来唯一标识对 应的映射语句就可以了。 </p>
<p><strong>7.映射器注解</strong></p>
<p>因为<strong>最初设计时,MyBatis 是一个 XML 驱动的框架</strong>。配置信息是基于 XML 的,而且映射语句也是定义在 XML 中的。而到了 MyBatis 3,有新的可用的选择了。MyBatis 3 构建 在基于全面而且强大的 Java 配置 API 之上。这个配置 API 是基于 XML 的 MyBatis 配置的 基础,也是新的基于注解配置的基础。注解提供了一种简单的方式来实现简单映射语句,而 不会引入大量的开销。 </p>
<p><strong>不幸的是,Java 注解限制了它们的表现和灵活</strong>。所以，要实现复杂的功能，还是使用xml进行配置吧。</p>
<p>请参考<a href="http://www.mybatis.org/mybatis-3/zh/java-api.html" target="_blank" rel="external">具体的注解</a></p>
<h2 id="SQL语句构建器类"><a href="#SQL语句构建器类" class="headerlink" title="SQL语句构建器类"></a>SQL语句构建器类</h2><p><em>1.问题</em></p>
<p>Java程序员面对的最痛苦的事情之一就是<strong>在Java代码中嵌入SQL语句</strong>。这么来做通常是<strong>由于SQL语句需要动态来生成-否则可以将它们放到外部文件或者存储过程中</strong>。正如你已经看到的那样，<strong>MyBatis在它的XML映射特性中有一个强大的动态SQL生成方案</strong>。但<strong>有时在Java代码内部创建SQL语句也是必要的</strong>。此时，MyBatis有另外一个特性可以帮到你，在减少典型的加号,引号,新行,格式化问题和嵌入条件来处理多余的逗号或 AND 连接词之前。事实上，在Java代码中来动态生成SQL代码就是一场噩梦。例如： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">String sql = &quot;SELECT P.ID, P.USERNAME, P.PASSWORD, P.FULL_NAME, &quot;</span><br><span class="line">&quot;P.LAST_NAME,P.CREATED_ON, P.UPDATED_ON &quot; +</span><br><span class="line">&quot;FROM PERSON P, ACCOUNT A &quot; +</span><br><span class="line">&quot;INNER JOIN DEPARTMENT D on D.ID = P.DEPARTMENT_ID &quot; +</span><br><span class="line">&quot;INNER JOIN COMPANY C on D.COMPANY_ID = C.ID &quot; +</span><br><span class="line">&quot;WHERE (P.ID = A.ID AND P.FIRST_NAME like ?) &quot; +</span><br><span class="line">&quot;OR (P.LAST_NAME like ?) &quot; +</span><br><span class="line">&quot;GROUP BY P.ID &quot; +</span><br><span class="line">&quot;HAVING (P.LAST_NAME like ?) &quot; +</span><br><span class="line">&quot;OR (P.FIRST_NAME like ?) &quot; +</span><br><span class="line">&quot;ORDER BY P.ID, P.FULL_NAME&quot;;</span><br></pre></td></tr></table></figure>
<p><em>2.The Solution</em></p>
<p>使用<strong>SQL类</strong>，简单地创建一个实例来调用方法生成SQL语句。上面示例中的问题就像重写SQL类那样： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">private String selectPersonSql() &#123;</span><br><span class="line">  return new SQL() &#123;&#123;</span><br><span class="line">    SELECT(&quot;P.ID, P.USERNAME, P.PASSWORD, P.FULL_NAME&quot;);</span><br><span class="line">    SELECT(&quot;P.LAST_NAME, P.CREATED_ON, P.UPDATED_ON&quot;);</span><br><span class="line">    FROM(&quot;PERSON P&quot;);</span><br><span class="line">    FROM(&quot;ACCOUNT A&quot;);</span><br><span class="line">    INNER_JOIN(&quot;DEPARTMENT D on D.ID = P.DEPARTMENT_ID&quot;);</span><br><span class="line">    INNER_JOIN(&quot;COMPANY C on D.COMPANY_ID = C.ID&quot;);</span><br><span class="line">    WHERE(&quot;P.ID = A.ID&quot;);</span><br><span class="line">    WHERE(&quot;P.FIRST_NAME like ?&quot;);</span><br><span class="line">    OR();</span><br><span class="line">    WHERE(&quot;P.LAST_NAME like ?&quot;);</span><br><span class="line">    GROUP_BY(&quot;P.ID&quot;);</span><br><span class="line">    HAVING(&quot;P.LAST_NAME like ?&quot;);</span><br><span class="line">    OR();</span><br><span class="line">    HAVING(&quot;P.FIRST_NAME like ?&quot;);</span><br><span class="line">    ORDER_BY(&quot;P.ID&quot;);</span><br><span class="line">    ORDER_BY(&quot;P.FULL_NAME&quot;);</span><br><span class="line">  &#125;&#125;.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>3.SQL类</em></p>
<p>具体的方法，像SELECT，INNER_JOIN等请参考<a href="http://www.mybatis.org/mybatis-3/zh/statement-builders.html" target="_blank" rel="external">方法</a></p>
<h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2><p>一、关于iBatis与JDBC的比较：<a href="https://www.packtpub.com/books/content/why-mybatis" target="_blank" rel="external">Eliminates a lot of JDBC boilerplate code</a></p>
<p>Java has a <strong>Java DataBase Connectivity (JDBC) API</strong> to work with relational databases. But <strong>JDBC is a very low-level API</strong>, and <strong>we need to write a lot of code to perform database operations</strong>.</p>
<p>该文章说明了使用步骤：</p>
<p>1.Configure the queries in a SQL Mapper config file, say StudentMapper.xml.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;findStudentById&quot; parameterType=&quot;int&quot;  </span><br><span class="line">resultType=&quot; Student&quot;&gt;</span><br><span class="line">  SELECT STUD_ID AS studId, NAME, EMAIL, DOB </span><br><span class="line">  FROM STUDENTS WHERE STUD_ID=#&#123;Id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>2.Create a StudentMapper interface.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface StudentMapper</span><br><span class="line">&#123;</span><br><span class="line">  Student findStudentById(Integer id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.In Java code, you can invoke these statements as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SqlSession session = getSqlSessionFactory().openSession();</span><br><span class="line">StudentMapper mapper =  </span><br><span class="line">session.getMapper(StudentMapper.class);</span><br><span class="line">// Select Student by Id</span><br><span class="line">Student student = mapper.selectStudentById(1);</span><br></pre></td></tr></table></figure>
<p>二、关于springBoot与iBatis的综合：<a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/" target="_blank" rel="external"><br>mybatis-spring-boot-autoconfigure
</a></p>
<p>该docs坑了我一把啊，两个例子并不能运行。究其原因是我mysql数据库没有配置正确，参考<a href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#boot-features-connect-to-production-database" target="_blank" rel="external">Spring Boot Reference Guide配置文档</a>，寻找spring.datasource开头的字眼，这是springBoot连接数据库需要做的一些配置，最后application.properties配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#执行语句</span><br><span class="line">spring.datasource.schema=classpath:import.sql</span><br><span class="line">#指明数据库</span><br><span class="line">spring.datasource.url = jdbc:mysql://localhost:3306/test</span><br><span class="line">#用户名</span><br><span class="line">spring.datasource.username = ×××</span><br><span class="line">#密码</span><br><span class="line">spring.datasource.password = ×××</span><br><span class="line">#固定，同时需要下载jdbc驱动</span><br><span class="line">spring.datasource.driver-class-name= com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure>
<p>对于最后一条，还需要在maven中下载驱动，添加依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;5.1.39&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>import.sql中内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table city(id int primary key auto_increment, name VARCHAR(40), state VARCHAR(40), country VARCHAR(40));</span><br><span class="line"></span><br><span class="line">insert into city (name, state, country) values (&apos;San Francisco&apos;, &apos;CA&apos;, &apos;US&apos;);</span><br></pre></td></tr></table></figure>
<p>成功运行。</p>
<p><strong>注意</strong>：在类和xml返回结果映射时，是<strong>忽略大小写</strong>的。也就是说，如果类中有属性ID，数据库返回的字段为id，那么是可以映射成功的。但是<strong>数据库下划线和java驼峰命令之间不能自动互相转换</strong>，应该加入下列配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">        &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">&lt;/settings&gt;</span><br></pre></td></tr></table></figure>
<p>在config的时候还需要注意的是，<strong><code>&lt;configuration&gt;</code>下元素是需要有顺序的</strong>，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;settings&gt;</span><br><span class="line">        &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">    &lt;/settings&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=&quot;mappers/GoodsMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
<p>如果将<code>&lt;mappers&gt;</code>提前到<code>&lt;settings&gt;</code>前面，那么该配置会报错。</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/后端开发/">后端开发</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2017/02/24/SpringBoot+Thymeleaf+iBatis开发项目/" data-title="SpringBoot+Thymeleaf+iBatis开发项目 | 曾先生&#39;s Blog" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2017/02/20/深入理解Java虚拟机/"  title="深入理解Java虚拟机">
 <strong>下一篇：</strong><br/> 
 <span>深入理解Java虚拟机
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2017/02/24/SpringBoot+Thymeleaf+iBatis开发项目/" data-title="SpringBoot+Thymeleaf+iBatis开发项目" data-url="http://yoursite.com/2017/02/24/SpringBoot+Thymeleaf+iBatis开发项目/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#maven"><span class="toc-number">1.</span> <span class="toc-text">maven</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Thymeleaf"><span class="toc-number">2.</span> <span class="toc-text">Thymeleaf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iBatis"><span class="toc-number">3.</span> <span class="toc-text">iBatis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#入门"><span class="toc-number">4.</span> <span class="toc-text">入门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XML-映射配置文件"><span class="toc-number">5.</span> <span class="toc-text">XML 映射配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mapper-XML-文件"><span class="toc-number">6.</span> <span class="toc-text">Mapper XML 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态-SQL"><span class="toc-number">7.</span> <span class="toc-text">动态 SQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java-API"><span class="toc-number">8.</span> <span class="toc-text">Java API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL语句构建器类"><span class="toc-number">9.</span> <span class="toc-text">SQL语句构建器类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更多"><span class="toc-number">10.</span> <span class="toc-text">更多</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  

  
  <div class="tagcloudlist">
    <p class="asidetitle">Tag Cloud</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Java/" style="font-size: 13.33px;">Java</a> <a href="/tags/Java编程思想读书笔记/" style="font-size: 16.67px;">Java编程思想读书笔记</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/TECH/" style="font-size: 11.67px;">TECH</a> <a href="/tags/后端开发/" style="font-size: 18.33px;">后端开发</a> <a href="/tags/数据结构与算法分析/" style="font-size: 11.67px;">数据结构与算法分析</a> <a href="/tags/机器学习/" style="font-size: 13.33px;">机器学习</a> <a href="/tags/程序人生/" style="font-size: 10px;">程序人生</a> <a href="/tags/程序员修炼之道读书笔记/" style="font-size: 13.33px;">程序员修炼之道读书笔记</a> <a href="/tags/算法4读书笔记/" style="font-size: 15px;">算法4读书笔记</a>
    </div>
  </div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="http://lucida.me/" target="_blank" title="Lucida&#39;s Blog">Lucida&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="http://hukai.me/" target="_blank" title="Hukai&#39;s Blog">Hukai&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="http://gank.io/" target="_blank" title="GANK">GANK</a>
            
          </li>
        
          <li>
            
            	<a href="http://stormzhang.com/" target="_blank" title="StormZhang&#39;s Blog">StormZhang&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.trinea.cn/" target="_blank" title="Trinea&#39;s Blog">Trinea&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=2766fecb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello , I&#39;m Zeng Qi , a Android developer , love Java , ML and Big Data . <br/>
			This is my blog , hope you will enjoy it . Let&#39;s make this world a better place .</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/18600103348" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/zengqi-ustb" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		<a href="http://www.zhihu.com/people/ceng-qi-29" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:zengqiustb@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		© 2016 
		
		<a href="/about" target="_blank" title="曾奇">曾奇</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"zengqi"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
